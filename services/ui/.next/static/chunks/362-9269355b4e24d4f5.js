"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[362],{4362:function(e,t,o){o.d(t,{AuthContextProvider:function(){return l},a:function(){return h}});var r=o(7437),a=o(2265),n=o(8112),s=o(1001),c=o(3227);let i=(0,a.createContext)(null);function l(e){let{children:t}=e,{instance:o,accounts:l,inProgress:h}=(0,n.Fp)(),u=(0,n.kq)(),[d,g]=(0,a.useState)(null),[f,m]=(0,a.useState)(null),[p,k]=(0,a.useState)(!1);(0,a.useEffect)(()=>{!u||d||p||"none"!==h?!u&&d&&y():w()},[u,d,h]);let y=()=>{console.log("Clearing authentication state"),g(null),m(null),c.x.setAccessToken(null)},w=async()=>{var e,t,r,a,n;if(u&&!p){console.log("Starting token acquisition process..."),k(!0);try{let a={...s.Qb,account:l[0]};console.log("Attempting silent token acquisition for scopes:",a.scopes);let n=await o.acquireTokenSilent(a);console.log("Token acquired successfully:",{hasAccessToken:!!n.accessToken,tokenLength:null===(e=n.accessToken)||void 0===e?void 0:e.length,scopes:n.scopes,account:null===(t=n.account)||void 0===t?void 0:t.username}),g(n.accessToken),c.x.setAccessToken(n.accessToken);let i=null===(r=n.account)||void 0===r?void 0:r.idTokenClaims;i&&m({name:i.name||i.preferred_username,email:i.email||i.preferred_username}),console.log("Access token set successfully in API client")}catch(e){console.error("Failed to acquire token silently:",e);try{console.log("Attempting interactive token acquisition...");let e=await o.acquireTokenPopup(s.Qb);console.log("Interactive token acquired:",{hasAccessToken:!!e.accessToken,tokenLength:null===(a=e.accessToken)||void 0===a?void 0:a.length,scopes:e.scopes}),g(e.accessToken),c.x.setAccessToken(e.accessToken);let t=null===(n=e.account)||void 0===n?void 0:n.idTokenClaims;t&&m({name:t.name||t.preferred_username,email:t.email||t.preferred_username}),console.log("Interactive access token set successfully in API client")}catch(e){console.error("Failed to acquire token via popup:",e)}}finally{k(!1)}}},T=async()=>{try{await o.loginPopup(s.Qb)}catch(e){console.error("Login failed:",e)}};return(0,r.jsx)(i.Provider,{value:{isAuthenticated:u&&!!d,isAcquiringToken:p,accessToken:d,userInfo:f,login:T,logout:()=>{console.log("Starting logout process"),y(),o.logoutPopup({postLogoutRedirectUri:window.location.origin})}},children:t})}function h(){let e=(0,a.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthContextProvider");return e}},3227:function(e,t,o){o.d(t,{x:function(){return a}});class r{setAccessToken(e){this.accessToken=e}getHeaders(){let e={Accept:"application/json","Content-Type":"application/json"};return this.accessToken?(e.Authorization="Bearer ".concat(this.accessToken),console.log("API request includes auth token (length:",this.accessToken.length,")")):console.warn("API request made WITHOUT auth token - user may need to sign in"),e}getStreamHeaders(){let e={Accept:"text/plain","Content-Type":"application/json"};return this.accessToken?(e.Authorization="Bearer ".concat(this.accessToken),console.log("Streaming API request includes auth token (length:",this.accessToken.length,")")):console.warn("Streaming API request made WITHOUT auth token - user may need to sign in"),e}async getHoldings(e){try{let t=this.formatDate(e),o="".concat(this.baseUrl,"/api/holdings/date/").concat(t),r=await fetch(o,{method:"GET",headers:this.getHeaders()});if(!r.ok){let e=await r.text();throw Error("HTTP ".concat(r.status,": ").concat(e))}let a=(await r.json()).holdings||[];return{data:a,message:"Successfully retrieved ".concat(a.length," holdings")}}catch(e){return console.error("Error fetching holdings:",e),{error:e instanceof Error?e.message:"Unknown error occurred"}}}async getHealthStatus(){try{let e="".concat(this.baseUrl,"/health");console.log("Attempting to connect to API health endpoint: ".concat(e)),console.log("Base URL configured as: ".concat(this.baseUrl));let t=await fetch(e);if(!t.ok)throw Error("Health check failed: ".concat(t.status));let o=await t.text();return console.log("API health check successful: ".concat(o)),{data:{status:o},message:"API is healthy"}}catch(e){return console.error("Health check failed:",e),console.error("Base URL was:",this.baseUrl),{error:e instanceof Error?e.message:"Health check failed"}}}formatDate(e){return new Date(e).toISOString().split("T")[0]}formatErrorMessage(e,t){return 401===e?"Please sign in to access the AI Assistant.":403===e?"You do not have permission to access this feature.":500===e&&t.includes("AuthorizationPolicy")?"Authentication required. Please sign in to continue.":e>=500?"The service is currently unavailable. Please try again later.":e>=400&&e<500?"There was a problem with your request. Please check your input and try again.":"HTTP ".concat(e,": ").concat(t)}async testConnection(){return!(await this.getHealthStatus()).error}async sendChatQueryStream(e,t,o,r,a,n,s){try{var c;let t="".concat(this.baseUrl,"/api/ai/chat/stream");console.log("Sending streaming chat query to: ".concat(t),{threadId:s});let a=await fetch(t,{method:"POST",headers:this.getStreamHeaders(),body:JSON.stringify({query:e,threadId:s})});if(!a.ok){let e=await a.text(),t=this.formatErrorMessage(a.status,e);throw Error(t)}let i=null===(c=a.body)||void 0===c?void 0:c.getReader();if(!i)throw Error("ReadableStream not supported");let l=new TextDecoder;try{let e="";for(;;){let{done:t,value:a}=await i.read();if(t){r();break}let s=l.decode(a,{stream:!0}),c=(e+=s).split("\n");for(let t of(e=c.pop()||"",c))if(t.trim())try{let e=JSON.parse(t);if("status"===e.MessageType&&e.Status&&n)n(e.Status);else if("content"===e.MessageType&&e.Content)o(e.Content);else if("completion"===e.MessageType){r();return}}catch(e){o(t)}}}finally{i.releaseLock()}}catch(e){console.error("Error in streaming chat query:",e),a(e instanceof Error?e.message:"Unknown error occurred")}}async sendChatQuery(e,t,o){try{let t="".concat(this.baseUrl,"/api/ai/chat/query");console.log("Sending chat query to: ".concat(t),{threadId:o});let r=await fetch(t,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({query:e,threadId:o})});if(!r.ok){let e=await r.text(),t=this.formatErrorMessage(r.status,e);throw Error(t)}return{data:await r.json(),message:"Chat query processed successfully"}}catch(e){return console.error("Error sending chat query:",e),{error:e instanceof Error?e.message:"Unknown error occurred"}}}async updateHoldingUnits(e,t){try{let o="".concat(this.baseUrl,"/api/holdings/").concat(e,"/units");console.log("Updating holding units: ".concat(o),{holdingId:e,units:t});let r=await fetch(o,{method:"PUT",headers:this.getHeaders(),body:JSON.stringify({units:t})});if(!r.ok){let e=await r.text(),t=this.formatErrorMessage(r.status,e);throw Error(t)}return{data:await r.json(),message:"Holding units updated successfully"}}catch(e){return console.error("Error updating holding units:",e),{error:e instanceof Error?e.message:"Failed to update holding units"}}}async deleteHolding(e){try{let t="".concat(this.baseUrl,"/api/holdings/").concat(e);console.log("Deleting holding: ".concat(t),{holdingId:e});let o=await fetch(t,{method:"DELETE",headers:this.getHeaders()});if(!o.ok){let e=await o.text(),t=this.formatErrorMessage(o.status,e);throw Error(t)}return{data:await o.json(),message:"Holding deleted successfully"}}catch(e){return console.error("Error deleting holding:",e),{error:e instanceof Error?e.message:"Failed to delete holding"}}}async checkInstrument(e){try{let t="".concat(this.baseUrl,"/api/instruments/check/").concat(encodeURIComponent(e.trim().toUpperCase()));console.log("Checking instrument: ".concat(t),{ticker:e});let o=await fetch(t,{method:"GET",headers:this.getHeaders()});if(o.ok)return{data:await o.json(),error:void 0};{let e=await o.json().catch(()=>({detail:"Unknown error"}));return{data:void 0,error:e.detail||"Failed to check instrument: ".concat(o.status)}}}catch(e){return console.error("Error checking instrument:",e),{data:void 0,error:e instanceof Error?e.message:"Unknown error occurred"}}}async addHolding(e,t){try{let o="".concat(this.baseUrl,"/api/holdings/portfolio/").concat(e);console.log("Adding new holding: ".concat(o),{portfolioId:e,request:t});let r=await fetch(o,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(t)});if(!r.ok){let e=await r.text(),t=this.formatErrorMessage(r.status,e);throw Error(t)}return{data:await r.json(),message:"Holding added successfully"}}catch(e){return console.error("Error adding holding:",e),{error:e instanceof Error?e.message:"Failed to add holding"}}}async getAvailableAiTools(){try{let e="".concat(this.baseUrl,"/api/ai/chat/tools");console.log("Fetching AI tools from: ".concat(e));let t=await fetch(e,{method:"GET",headers:this.getHeaders()});if(!t.ok){let e=await t.text();throw Error("HTTP ".concat(t.status,": ").concat(e))}let o=await t.json();return{data:o,message:"Successfully retrieved ".concat(o.length," AI tools")}}catch(e){return console.error("Error fetching AI tools:",e),{error:e instanceof Error?e.message:"Unknown error occurred"}}}async getChatHealthStatus(){try{let e="".concat(this.baseUrl,"/api/ai/chat/health");console.log("Checking AI chat health: ".concat(e));let t=await fetch(e,{method:"GET",headers:this.getHeaders()});if(!t.ok)throw Error("AI chat health check failed: ".concat(t.status));return{data:await t.json(),message:"AI chat service is healthy"}}catch(e){return console.error("AI chat health check failed:",e),{error:e instanceof Error?e.message:"AI chat health check failed"}}}constructor(e){var t,o;this.accessToken=null,null===(o=window.location)||void 0===o||null===(t=o.origin)||void 0===t||t.replace("3000","8080"),this.baseUrl=(e||"http://localhost:8080").replace(/\/$/,"")}}let a=new r},1001:function(e,t,o){o.d(t,{Qb:function(){return n},XM:function(){return a}});var r=o(1986);let a={auth:{clientId:(()=>{let e="4884728d-b70f-4695-a359-a291ddfa3574";if(!e)throw Error("NEXT_PUBLIC_AZURE_CLIENT_ID environment variable is required. Please set it in your .env.local file.");return e})(),authority:"https://login.microsoftonline.com/".concat((()=>{let e="1f6e5d9e-5f2d-44ae-a729-05e20ecd4f75";if(!e)throw Error("NEXT_PUBLIC_AZURE_TENANT_ID environment variable is required. Please set it in your .env.local file.");return e})()),redirectUri:window.location.origin,postLogoutRedirectUri:window.location.origin},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{loggerCallback:(e,t,o)=>{if(!o)switch(e){case r.i.Error:console.error(t);return;case r.i.Info:console.info(t);return;case r.i.Verbose:console.debug(t);return;case r.i.Warning:console.warn(t);return}}}}},n={scopes:["api://".concat((()=>{let e="78661cad-e894-4462-9d21-5c7d10c56a3e";if(!e)throw Error("NEXT_PUBLIC_AZURE_API_CLIENT_ID environment variable is required. Please set it in your .env.local file.");return e})(),"/Portfolio.ReadWrite")],prompt:"select_account"}}}]);