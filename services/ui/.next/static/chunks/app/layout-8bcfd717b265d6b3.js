(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{310:function(e,t,o){Promise.resolve().then(o.t.bind(o,4811,23)),Promise.resolve().then(o.t.bind(o,2778,23)),Promise.resolve().then(o.bind(o,2582)),Promise.resolve().then(o.bind(o,5165)),Promise.resolve().then(o.bind(o,4362))},2582:function(e,t,o){"use strict";o.d(t,{AuthProvider:function(){return i}});var r=o(7437),n=o(4991),a=o(8112),s=o(1001);let c=new n.Lx(s.XM);function i(e){let{children:t}=e;return(0,r.jsx)(a.rL,{instance:c,children:t})}},5165:function(e,t,o){"use strict";o.d(t,{ClientOnly:function(){return a}});var r=o(7437),n=o(2265);function a(e){let{children:t}=e,[o,a]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{a(!0)},[]),o)?(0,r.jsx)(r.Fragment,{children:t}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin h-8 w-8 border-2 border-blue-600 border-t-transparent rounded-full"})})}},4362:function(e,t,o){"use strict";o.d(t,{AuthContextProvider:function(){return l},a:function(){return u}});var r=o(7437),n=o(2265),a=o(8112),s=o(1001),c=o(3227);let i=(0,n.createContext)(null);function l(e){let{children:t}=e,{instance:o,accounts:l,inProgress:u}=(0,a.Fp)(),h=(0,a.kq)(),[d,g]=(0,n.useState)(null),[f,m]=(0,n.useState)(null),[k,p]=(0,n.useState)(!1);(0,n.useEffect)(()=>{!h||d||k?!h&&d&&w():y()},[h,d,k]);let w=()=>{console.log("Clearing authentication state"),g(null),m(null),c.x.setAccessToken(null)},y=async()=>{var e,t,r,n,a;if(h&&!k){console.log("Starting token acquisition process..."),p(!0);try{let n={...s.Qb,account:l[0]};console.log("Attempting silent token acquisition for scopes:",n.scopes);let a=await o.acquireTokenSilent(n);console.log("Token acquired successfully:",{hasAccessToken:!!a.accessToken,tokenLength:null===(e=a.accessToken)||void 0===e?void 0:e.length,scopes:a.scopes,account:null===(t=a.account)||void 0===t?void 0:t.username}),g(a.accessToken),c.x.setAccessToken(a.accessToken);let i=null===(r=a.account)||void 0===r?void 0:r.idTokenClaims;i&&m({name:i.name||i.preferred_username,email:i.email||i.preferred_username}),console.log("Access token set successfully in API client")}catch(e){console.error("Failed to acquire token silently:",e);try{console.log("Attempting interactive token acquisition...");let e=await o.acquireTokenPopup(s.Qb);console.log("Interactive token acquired:",{hasAccessToken:!!e.accessToken,tokenLength:null===(n=e.accessToken)||void 0===n?void 0:n.length,scopes:e.scopes}),g(e.accessToken),c.x.setAccessToken(e.accessToken);let t=null===(a=e.account)||void 0===a?void 0:a.idTokenClaims;t&&m({name:t.name||t.preferred_username,email:t.email||t.preferred_username}),console.log("Interactive access token set successfully in API client")}catch(e){console.error("Failed to acquire token via popup:",e)}}finally{p(!1)}}},T=async()=>{try{await o.loginPopup(s.Qb)}catch(e){console.error("Login failed:",e)}};return(0,r.jsx)(i.Provider,{value:{isAuthenticated:h&&!!d,isAcquiringToken:k,accessToken:d,userInfo:f,login:T,logout:()=>{console.log("Starting logout process"),w(),o.logoutPopup({postLogoutRedirectUri:window.location.origin})}},children:t})}function u(){let e=(0,n.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthContextProvider");return e}},3227:function(e,t,o){"use strict";o.d(t,{x:function(){return n}});class r{setAccessToken(e){this.accessToken=e}getHeaders(){let e={Accept:"application/json","Content-Type":"application/json"};return this.accessToken?(e.Authorization="Bearer ".concat(this.accessToken),console.log("API request includes auth token (length:",this.accessToken.length,")")):console.warn("API request made WITHOUT auth token"),e}getStreamHeaders(){let e={Accept:"text/plain","Content-Type":"application/json"};return this.accessToken?(e.Authorization="Bearer ".concat(this.accessToken),console.log("Streaming API request includes auth token (length:",this.accessToken.length,")")):console.warn("Streaming API request made WITHOUT auth token"),e}async getHoldings(e){try{let t=this.formatDate(e),o="".concat(this.baseUrl,"/api/holdings/date/").concat(t),r=await fetch(o,{method:"GET",headers:this.getHeaders()});if(!r.ok){let e=await r.text();throw Error("HTTP ".concat(r.status,": ").concat(e))}let n=(await r.json()).holdings||[];return{data:n,message:"Successfully retrieved ".concat(n.length," holdings")}}catch(e){return console.error("Error fetching holdings:",e),{error:e instanceof Error?e.message:"Unknown error occurred"}}}async getHealthStatus(){try{let e="".concat(this.baseUrl,"/health");console.log("Attempting to connect to API health endpoint: ".concat(e)),console.log("Base URL configured as: ".concat(this.baseUrl));let t=await fetch(e);if(!t.ok)throw Error("Health check failed: ".concat(t.status));let o=await t.text();return console.log("API health check successful: ".concat(o)),{data:{status:o},message:"API is healthy"}}catch(e){return console.error("Health check failed:",e),console.error("Base URL was:",this.baseUrl),{error:e instanceof Error?e.message:"Health check failed"}}}formatDate(e){return new Date(e).toISOString().split("T")[0]}formatErrorMessage(e,t){return 401===e?"Please sign in to access the AI Assistant.":403===e?"You do not have permission to access this feature.":500===e&&t.includes("AuthorizationPolicy")?"Authentication required. Please sign in to continue.":e>=500?"The service is currently unavailable. Please try again later.":e>=400&&e<500?"There was a problem with your request. Please check your input and try again.":"HTTP ".concat(e,": ").concat(t)}async testConnection(){return!(await this.getHealthStatus()).error}async sendChatQueryStream(e,t,o,r,n,a){try{var s;let n="".concat(this.baseUrl,"/api/ai/chat/stream");console.log("Sending streaming chat query to: ".concat(n),{threadId:a});let c=await fetch(n,{method:"POST",headers:this.getStreamHeaders(),body:JSON.stringify({query:e,accountId:t,threadId:a})});if(!c.ok){let e=await c.text(),t=this.formatErrorMessage(c.status,e);throw Error(t)}let i=null===(s=c.body)||void 0===s?void 0:s.getReader();if(!i)throw Error("ReadableStream not supported");let l=new TextDecoder;try{for(;;){let{done:e,value:t}=await i.read();if(e){r();break}let n=l.decode(t,{stream:!0});o(n)}}finally{i.releaseLock()}}catch(e){console.error("Error in streaming chat query:",e),n(e instanceof Error?e.message:"Unknown error occurred")}}async sendChatQuery(e,t,o){try{let r="".concat(this.baseUrl,"/api/ai/chat/query");console.log("Sending chat query to: ".concat(r),{threadId:o});let n=await fetch(r,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({query:e,accountId:t,threadId:o})});if(!n.ok){let e=await n.text(),t=this.formatErrorMessage(n.status,e);throw Error(t)}return{data:await n.json(),message:"Chat query processed successfully"}}catch(e){return console.error("Error sending chat query:",e),{error:e instanceof Error?e.message:"Unknown error occurred"}}}async getAvailableAiTools(){try{let e="".concat(this.baseUrl,"/api/ai/chat/tools");console.log("Fetching AI tools from: ".concat(e));let t=await fetch(e,{method:"GET",headers:this.getHeaders()});if(!t.ok){let e=await t.text();throw Error("HTTP ".concat(t.status,": ").concat(e))}let o=await t.json();return{data:o,message:"Successfully retrieved ".concat(o.length," AI tools")}}catch(e){return console.error("Error fetching AI tools:",e),{error:e instanceof Error?e.message:"Unknown error occurred"}}}async getChatHealthStatus(){try{let e="".concat(this.baseUrl,"/api/ai/chat/health");console.log("Checking AI chat health: ".concat(e));let t=await fetch(e,{method:"GET",headers:this.getHeaders()});if(!t.ok)throw Error("AI chat health check failed: ".concat(t.status));return{data:await t.json(),message:"AI chat service is healthy"}}catch(e){return console.error("AI chat health check failed:",e),{error:e instanceof Error?e.message:"AI chat health check failed"}}}constructor(e){var t,o;this.accessToken=null,null===(o=window.location)||void 0===o||null===(t=o.origin)||void 0===t||t.replace("3000","8080"),this.baseUrl=(e||"http://localhost:8080").replace(/\/$/,"")}}let n=new r},1001:function(e,t,o){"use strict";o.d(t,{Qb:function(){return a},XM:function(){return n}});var r=o(1986);let n={auth:{clientId:(()=>{let e="4884728d-b70f-4695-a359-a291ddfa3574";if(!e)throw Error("NEXT_PUBLIC_AZURE_CLIENT_ID environment variable is required. Please set it in your .env.local file.");return e})(),authority:"https://login.microsoftonline.com/".concat((()=>{let e="1f6e5d9e-5f2d-44ae-a729-05e20ecd4f75";if(!e)throw Error("NEXT_PUBLIC_AZURE_TENANT_ID environment variable is required. Please set it in your .env.local file.");return e})()),redirectUri:window.location.origin,postLogoutRedirectUri:window.location.origin},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{loggerCallback:(e,t,o)=>{if(!o)switch(e){case r.i.Error:console.error(t);return;case r.i.Info:console.info(t);return;case r.i.Verbose:console.debug(t);return;case r.i.Warning:console.warn(t);return}}}}},a={scopes:["api://".concat((()=>{let e="78661cad-e894-4462-9d21-5c7d10c56a3e";if(!e)throw Error("NEXT_PUBLIC_AZURE_API_CLIENT_ID environment variable is required. Please set it in your .env.local file.");return e})(),"/Portfolio.ReadWrite")],prompt:"select_account"}},2778:function(){}},function(e){e.O(0,[2,112,476,971,117,744],function(){return e(e.s=310)}),_N_E=e.O()}]);