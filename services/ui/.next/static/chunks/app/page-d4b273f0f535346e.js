(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3162:function(e,t,s){Promise.resolve().then(s.bind(s,9041))},9041:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return O}});var a=s(7437),r=s(2265),l=s(891),n=s(3227);let i=e=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:2,maximumFractionDigits:2}).format(e),o=e=>new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:4}).format(e),c=e=>new Date(e).toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"}),d=()=>[{field:"platformName",headerName:"Platform",width:130,sortable:!0,filter:!0,pinned:"left"},{field:"instrumentName",headerName:"Instrument",width:200,sortable:!0,filter:!0,tooltipField:"instrumentName"},{field:"ticker",headerName:"Ticker",width:100,sortable:!0,filter:!0,cellStyle:{fontFamily:"monospace",fontWeight:"bold"}},{field:"instrumentType",headerName:"Type",width:120,sortable:!0,filter:!0,hide:!0},{field:"unitAmount",headerName:"Units",width:120,sortable:!0,filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:e=>o(e.value),cellStyle:{textAlign:"right",fontFamily:"monospace"}},{field:"boughtValue",headerName:"Bought Value",width:130,sortable:!0,filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:e=>i(e.value),cellStyle:{textAlign:"right",fontFamily:"monospace"}},{field:"currentValue",headerName:"Current Value",width:140,sortable:!0,filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:e=>i(e.value),cellStyle:e=>({textAlign:"right",fontFamily:"monospace",fontWeight:"bold",color:e.value>0?"#10b981":"#ef4444"})},{field:"gainLoss",headerName:"Gain/Loss",width:130,sortable:!0,filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:e=>i(e.value),cellStyle:e=>({textAlign:"right",fontFamily:"monospace",fontWeight:"bold",color:e.value>=0?"#10b981":"#ef4444"})},{field:"gainLossPercentage",headerName:"Gain/Loss %",width:120,sortable:!0,filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:e=>"".concat(o(e.value),"%"),cellStyle:e=>({textAlign:"right",fontFamily:"monospace",fontWeight:"bold",color:e.value>=0?"#10b981":"#ef4444"})},{field:"dailyProfitLoss",headerName:"Daily P/L",width:120,sortable:!0,filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:e=>i(e.value),cellStyle:e=>({textAlign:"right",fontFamily:"monospace",fontWeight:"bold",color:e.value>=0?"#10b981":"#ef4444",backgroundColor:e.value>=0?"#f0f9ff":"#fef2f2"})},{field:"dailyProfitLossPercentage",headerName:"Daily P/L %",width:120,sortable:!0,filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:e=>"".concat(o(e.value),"%"),cellStyle:e=>({textAlign:"right",fontFamily:"monospace",fontWeight:"bold",color:e.value>=0?"#10b981":"#ef4444",backgroundColor:e.value>=0?"#f0f9ff":"#fef2f2"})},{field:"valuationDate",headerName:"Valuation Date",width:140,sortable:!0,filter:"agDateColumnFilter",valueFormatter:e=>c(e.value)}],m=e=>e.reduce((e,t)=>e+t.currentValue,0),h=e=>e.reduce((e,t)=>e+t.dailyProfitLoss,0),x=e=>{if(0===e.length)return 0;let t=h(e),s=m(e);return 0!==s?t/s*100:0};var u=s(370),g=s(1047),f=s(7168);s(4868),s(3893);let p=()=>{let[e,t]=(0,r.useState)([]),[s,o]=(0,r.useState)(!1),[c,p]=(0,r.useState)(null),[b,y]=(0,r.useState)(new Date().toISOString().split("T")[0]),[j,N]=(0,r.useState)(0),[v,w]=(0,r.useState)(0),[k,A]=(0,r.useState)(null),[S,I]=(0,r.useState)(!1),[C,T]=(0,r.useState)([]),P=(0,r.useCallback)(async()=>{o(!0),p(null);try{let e=await n.x.getHoldings(b);e.error?(p(e.error),t([])):t(e.data||[])}catch(e){p("Failed to fetch holdings"),t([])}finally{o(!1)}},[b]),E=(0,r.useCallback)(()=>{if(!k)return;let e=0,t=0;k.forEachNodeAfterFilter(s=>{s.data&&(e+=s.data.currentValue||0,t++)}),N(e),w(t)},[k]),F=(0,r.useCallback)(e=>{A(e.api),setTimeout(()=>{let t=0,s=0;e.api.forEachNodeAfterFilter(e=>{e.data&&(t+=e.data.currentValue||0,s++)}),N(t),w(s)},100)},[]),L=(0,r.useCallback)(()=>{E()},[E]);(0,r.useEffect)(()=>{E()},[e,E]),(0,r.useEffect)(()=>{P()},[P]);let Z=m(e),U=h(e),q=x(e);return e.length,(0,a.jsxs)("div",{className:"w-full h-full bg-white",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-primary-600 to-primary-700 p-4 text-white",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(u.Z,{className:"h-6 w-6"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-bold",children:"Portfolio Holdings"}),(0,a.jsx)("p",{className:"text-primary-100 text-sm",children:"Authenticated User's Holdings"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(g.Z,{className:"h-4 w-4"}),(0,a.jsx)("input",{type:"date",value:b,onChange:e=>y(e.target.value),className:"bg-transparent border-b border-white/30 text-white text-sm focus:border-white focus:outline-none"})]}),(0,a.jsxs)("div",{className:"text-right space-y-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-xs text-primary-100",children:[v!==e.length?"Filtered":"Total"," Value"]}),(0,a.jsx)("p",{className:"text-lg font-bold",children:i(j>0?j:Z)}),v!==e.length&&(0,a.jsxs)("p",{className:"text-xs text-primary-200",children:["Total: ",i(Z)]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-primary-100",children:"Daily P&L"}),(0,a.jsxs)("p",{className:"text-sm font-bold ".concat(U>=0?"text-green-200":"text-red-200"),children:[i(U)," (",q>=0?"+":"",q.toFixed(2),"%)"]})]})]}),(0,a.jsxs)("button",{onClick:P,disabled:s,className:"flex items-center space-x-2 bg-white/20 hover:bg-white/30 px-3 py-2 rounded-lg transition-colors duration-200",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 ".concat(s?"animate-spin":"")}),(0,a.jsx)("span",{className:"text-sm",children:"Refresh"})]})]})]})}),(0,a.jsxs)("div",{className:"w-full h-[calc(100%-80px)] flex flex-col",children:[c&&(0,a.jsx)("div",{className:"mx-4 mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-red-700",children:[(0,a.jsx)("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),(0,a.jsxs)("span",{className:"font-medium text-sm",children:["Error: ",c]})]})}),(0,a.jsx)("div",{className:"flex-1 w-full px-4 pb-4",children:(0,a.jsx)("div",{className:"ag-theme-alpine w-full h-full",style:{minHeight:"500px"},children:(0,a.jsx)(l.s,{rowData:e,columnDefs:d(),onGridReady:F,onFilterChanged:L,defaultColDef:{sortable:!0,filter:!0,resizable:!0,minWidth:120,flex:1},enableRangeSelection:!0,aggFuncs:{sum:e=>e.values.filter(e=>null!=e&&!isNaN(e)).reduce((e,t)=>e+t,0),avg:e=>{let t=e.values.filter(e=>null!=e&&!isNaN(e));return 0===t.length?0:t.reduce((e,t)=>e+t,0)/t.length},count:e=>e.values.filter(e=>null!=e).length},pagination:!0,paginationPageSize:50,rowSelection:"multiple",suppressHorizontalScroll:!1,alwaysShowHorizontalScroll:!1,suppressColumnVirtualisation:!1,maintainColumnOrder:!0})})}),e.length>0&&(0,a.jsx)("div",{className:"px-4 pb-4",children:(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg p-3",children:(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsxs)("span",{children:["Showing ",v," of ",e.length," holdings",v!==e.length&&(0,a.jsx)("span",{className:"text-blue-600 font-medium",children:" (filtered)"})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-6",children:[v!==e.length&&(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["Total Portfolio: ",i(Z)]}),(0,a.jsxs)("span",{className:"font-semibold",children:[v!==e.length?"Filtered":"Total"," Value:",(0,a.jsx)("span",{className:"text-green-600 text-base ml-1",children:i(j>0?j:Z)})]})]})]})})})]})]})};var b=s(236),y=s(3260),j=s(5846),N=s(4401),v=s(525),w=s(3085),k=s(2369),A=s(2222),S=s(9322),I=s(1723),C=s(9090),T=s(4743),P=s(4362);function E(e){let{accountId:t,className:s="",isVisible:l=!0}=e,[i,o]=(0,r.useState)(""),[c,d]=(0,r.useState)(void 0),{isAuthenticated:m,login:h}=(0,P.a)(),[x,u]=(0,r.useState)({messages:[{id:"1",type:"system",content:'Welcome! I\'m your AI portfolio assistant. Ask me anything about your portfolio, such as:\n        \n• "How is my portfolio performing today?"\n• "What are my top holdings?"\n• "Show me market sentiment for my stocks"\n• "Compare my performance from last week"\n        \nI can analyze your holdings, market conditions, and provide insights to help you make informed decisions.',timestamp:new Date}],isLoading:!1}),g=(0,r.useRef)(null),f=(0,r.useRef)(null),p=()=>{var e;null===(e=g.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,r.useEffect)(()=>{p()},[x.messages]),(0,r.useEffect)(()=>{l&&setTimeout(()=>p(),100)},[l]);let E=()=>"msg_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),F=async e=>{if(e.preventDefault(),!i.trim()||x.isLoading)return;let s={id:E(),type:"user",content:i.trim(),timestamp:new Date},a=E(),r={id:a,type:"ai",content:"",timestamp:new Date,isLoading:!0};u(e=>({...e,messages:[...e.messages,s,r],isLoading:!0}));let l=i.trim();o("");let m="",h=!0;try{await n.x.sendChatQueryStream(l,t,e=>{m+=e,u(e=>({...e,messages:e.messages.map(e=>e.id===a?{...e,content:m,isLoading:!1}:e)}))},()=>{u(e=>({...e,isLoading:!1,error:void 0}))},async e=>{console.warn("Streaming failed, falling back to regular API:",e),h=!1;try{var s,r,i,o,m;let e=await n.x.sendChatQuery(l,t,c);if(e.error)throw Error(e.error);(null===(s=e.data)||void 0===s?void 0:s.threadId)&&!c&&d(e.data.threadId);let h={id:a,type:"ai",content:(null===(r=e.data)||void 0===r?void 0:r.response)||"I apologize, but I couldn't process your request.",timestamp:new Date,queryType:null===(i=e.data)||void 0===i?void 0:i.queryType,portfolioSummary:null===(o=e.data)||void 0===o?void 0:o.portfolioSummary,insights:null===(m=e.data)||void 0===m?void 0:m.insights};u(e=>({...e,messages:e.messages.map(e=>e.id===a?h:e),isLoading:!1,error:void 0}))}catch(t){let e={id:a,type:"ai",content:"I apologize, but I encountered an error: ".concat(t instanceof Error?t.message:"Unknown error"),timestamp:new Date,error:t instanceof Error?t.message:"Unknown error"};u(s=>({...s,messages:s.messages.map(t=>t.id===a?e:t),isLoading:!1,error:t instanceof Error?t.message:"Unknown error"}))}},c)}catch(t){if(!h)return;let e={id:a,type:"ai",content:"I apologize, but I encountered an error: ".concat(t instanceof Error?t.message:"Unknown error"),timestamp:new Date,error:t instanceof Error?t.message:"Unknown error"};u(s=>({...s,messages:s.messages.map(t=>t.id===a?e:t),isLoading:!1,error:t instanceof Error?t.message:"Unknown error"}))}},L=e=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:2}).format(e),Z=e=>"".concat(e>=0?"+":"").concat((100*e).toFixed(2),"%"),U=(e,t)=>(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mt-2",children:(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-900 text-sm",children:e.title}),(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("High"===e.impact?"bg-red-100 text-red-800":"Medium"===e.impact?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.impact})]}),(0,a.jsx)("p",{className:"text-blue-800 text-sm mt-1",children:e.description}),(0,a.jsx)("span",{className:"text-blue-600 text-xs mt-1 block",children:e.category})]})]})},t),q=e=>(0,a.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mt-3",children:[(0,a.jsxs)("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[(0,a.jsx)(N.Z,{className:"h-4 w-4 mr-2"}),"Portfolio Summary"]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Total Value"}),(0,a.jsx)("p",{className:"font-bold text-lg",children:L(e.totalValue)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Day Change"}),(0,a.jsxs)("p",{className:"font-bold text-lg flex items-center ".concat(e.dayChange>=0?"text-green-600":"text-red-600"),children:[e.dayChange>=0?(0,a.jsx)(v.Z,{className:"h-4 w-4 mr-1"}):(0,a.jsx)(w.Z,{className:"h-4 w-4 mr-1"}),L(e.dayChange)," (",Z(e.dayChangePercentage),")"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Holdings Count"}),(0,a.jsx)("p",{className:"font-bold",children:e.holdingsCount})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Date"}),(0,a.jsx)("p",{className:"font-bold",children:new Date(e.date).toLocaleDateString()})]})]}),e.topHoldings&&e.topHoldings.length>0&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Top Holdings"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.topHoldings.map((e,t)=>(0,a.jsx)("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium",children:e},t))})]})]});return(0,a.jsx)("div",{className:"flex flex-col h-full bg-white ".concat(s),children:m?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:[x.messages.map(e=>{let t="user"===e.type,s="system"===e.type;return(0,a.jsx)("div",{className:"flex ".concat(t?"justify-end":"justify-start"," mb-4"),children:(0,a.jsxs)("div",{className:"flex items-start space-x-2 max-w-[95%] ".concat(t?"flex-row-reverse space-x-reverse":""),children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ".concat(t?"bg-blue-600 text-white":s?"bg-gray-500 text-white":"bg-green-600 text-white"),children:t?(0,a.jsx)(k.Z,{className:"h-4 w-4"}):(0,a.jsx)(A.Z,{className:"h-4 w-4"})}),(0,a.jsx)("div",{className:"rounded-xl px-4 py-3 ".concat(t?"bg-blue-600 text-white":s?"bg-gray-100 text-gray-800 border":e.error?"bg-red-50 text-red-800 border border-red-200":"bg-white text-gray-800 border shadow-sm"),children:e.isLoading?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-gray-300 border-t-blue-600 rounded-full"}),(0,a.jsx)("span",{className:"text-sm",children:"Thinking..."})]}):(0,a.jsxs)(a.Fragment,{children:[e.error&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,a.jsx)(S.Z,{className:"h-4 w-4 text-red-600"}),(0,a.jsx)("span",{className:"text-sm font-medium text-red-800",children:"Error"})]}),(0,a.jsx)("div",{className:"max-w-none",children:t?(0,a.jsx)("div",{className:"whitespace-pre-wrap text-white",children:e.content}):(0,a.jsx)(b.UG,{remarkPlugins:[y.Z],components:{table:e=>{let{children:t}=e;return(0,a.jsx)("div",{className:"chat-table-container",children:(0,a.jsx)("table",{className:"chat-table",children:t})})},thead:e=>{let{children:t}=e;return(0,a.jsx)("thead",{children:t})},tbody:e=>{let{children:t}=e;return(0,a.jsx)("tbody",{children:t})},tr:e=>{let{children:t}=e;return(0,a.jsx)("tr",{children:t})},th:e=>{let{children:t}=e;return(0,a.jsx)("th",{children:t})},td:e=>{let{children:t}=e;return(0,a.jsx)("td",{children:t})},h1:e=>{let{children:t}=e;return(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-3",children:t})},h2:e=>{let{children:t}=e;return(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:t})},h3:e=>{let{children:t}=e;return(0,a.jsx)("h3",{className:"text-md font-medium text-gray-900 mb-2",children:t})},p:e=>{let{children:t}=e;return(0,a.jsx)("p",{className:"mb-2 text-gray-800",children:t})},strong:e=>{let{children:t}=e;return(0,a.jsx)("strong",{className:"font-semibold text-gray-900",children:t})},ul:e=>{let{children:t}=e;return(0,a.jsx)("ul",{className:"list-disc list-outside mb-2 ml-4 space-y-0",children:t})},ol:e=>{let{children:t}=e;return(0,a.jsx)("ol",{className:"list-decimal list-outside mb-2 ml-4 space-y-0",children:t})},li:e=>{let{children:t}=e;return(0,a.jsx)("li",{className:"text-gray-800 mb-1",children:t})},code:e=>{var t;let{children:s,...r}=e;return(null===(t=r.className)||void 0===t?void 0:t.includes("inline"))||!r.className?(0,a.jsx)("code",{className:"bg-gray-100 text-gray-800 px-1 py-0.5 rounded text-sm font-mono",children:s}):(0,a.jsx)("pre",{className:"bg-gray-100 text-gray-800 p-3 rounded-lg overflow-x-auto",children:(0,a.jsx)("code",{className:"text-sm font-mono",children:s})})},blockquote:e=>{let{children:t}=e;return(0,a.jsx)("blockquote",{className:"border-l-4 border-blue-500 pl-4 italic text-gray-700 my-2",children:t})}},children:e.content})}),e.portfolioSummary&&q(e.portfolioSummary),e.insights&&e.insights.length>0&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsxs)("h4",{className:"font-medium text-gray-900 mb-2 flex items-center",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"Insights"]}),e.insights.map(U)]}),(0,a.jsxs)("div",{className:"text-xs mt-2 flex items-center ".concat(t?"text-blue-200":"text-gray-500"),children:[(0,a.jsx)(I.Z,{className:"h-3 w-3 mr-1"}),e.timestamp.toLocaleTimeString(),e.queryType&&(0,a.jsx)("span",{className:"ml-2 bg-gray-200 text-gray-700 px-2 py-0.5 rounded-full",children:e.queryType})]})]})})]})},e.id)}),(0,a.jsx)("div",{ref:g})]}),(0,a.jsxs)("div",{className:"border-t border-gray-200 p-4 bg-white",children:[(0,a.jsxs)("form",{onSubmit:F,className:"flex space-x-3",children:[(0,a.jsx)("input",{ref:f,type:"text",value:i,onChange:e=>o(e.target.value),placeholder:"Ask me about your portfolio...",disabled:x.isLoading,className:"flex-1 border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-base"}),(0,a.jsx)("button",{type:"submit",disabled:x.isLoading||!i.trim(),className:"bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium",children:(0,a.jsx)(T.Z,{className:"h-5 w-5"})})]}),x.error&&(0,a.jsxs)("div",{className:"mt-3 text-sm text-red-600 flex items-center justify-between bg-red-50 p-3 rounded-lg border border-red-200",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(S.Z,{className:"h-4 w-4 mr-2 flex-shrink-0"}),(0,a.jsx)("span",{children:x.error})]}),(x.error.includes("sign in")||x.error.includes("Authentication"))&&(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"ml-3 bg-blue-600 text-white px-3 py-1 rounded-md text-xs hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})]})]}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center p-8",children:(0,a.jsxs)("div",{className:"text-center max-w-md",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)(A.Z,{className:"h-10 w-10 text-blue-600"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"AI Assistant Ready"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Sign in to access your AI portfolio assistant and get personalized insights about your investments."}),(0,a.jsxs)("button",{onClick:h,className:"inline-flex items-center space-x-2 bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 transition-colors font-medium",children:[(0,a.jsx)(C.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Sign In to Start"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-4",children:"Once authenticated, you can ask questions about your portfolio performance, holdings, and get market insights."})]})})})}var F=s(8112),L=s(8906),Z=s(7692);function U(){let{inProgress:e}=(0,F.Fp)(),{isAuthenticated:t,isAcquiringToken:s,accessToken:r,userInfo:l,login:n,logout:i}=(0,P.a)();return"login"===e?(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-blue-600",children:[(0,a.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-blue-600 border-t-transparent rounded-full"}),(0,a.jsx)("span",{className:"text-sm",children:"Signing in..."})]}):s?(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-blue-600",children:[(0,a.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-blue-600 border-t-transparent rounded-full"}),(0,a.jsx)("span",{className:"text-sm",children:"Getting access token..."})]}):t?(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"flex items-center space-x-2",children:r?(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-green-600",children:[(0,a.jsx)(L.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Authenticated"})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-yellow-600",children:[(0,a.jsx)(S.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Getting token..."})]})}),l&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-gray-700",children:[(0,a.jsx)(k.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm",children:l.name||l.email})]}),(0,a.jsxs)("button",{onClick:i,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,a.jsx)(Z.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm",children:"Sign Out"})]})]}):(0,a.jsxs)("button",{onClick:n,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,a.jsx)(C.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Sign In"})]})}var q=s(8420),D=s(6215),H=s(3417),_=s(1671);function R(e){let{id:t,label:s,icon:r,isActive:l,onClick:n}=e;return(0,a.jsxs)("button",{onClick:n,className:"flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ".concat(l?"bg-blue-600 text-white shadow-md":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:[r,(0,a.jsx)("span",{className:"text-sm",children:s})]})}function O(){let[e,t]=(0,r.useState)("checking"),[s,l]=(0,r.useState)("checking"),[i,o]=(0,r.useState)("holdings"),{isAuthenticated:c}=(0,P.a)();return(0,r.useEffect)(()=>{(async()=>{console.log("Checking services, authenticated:",c);try{let e=await n.x.testConnection();if(t(e?"online":"offline"),c){l("checking");try{let e=await n.x.getChatHealthStatus();l(e.error?"offline":"online")}catch(e){console.log("AI service check failed:",e),l("offline")}}else console.log("Not authenticated, setting AI status to offline"),l("offline")}catch(e){t("offline"),l("offline")}})()},[c]),(0,a.jsxs)("div",{className:"h-screen bg-gradient-to-br from-financial-gray-50 to-financial-gray-100 flex flex-col",children:[(0,a.jsx)("header",{className:"bg-white shadow-financial border-b border-financial-gray-200 flex-shrink-0",children:(0,a.jsx)("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-8",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(q.Z,{className:"h-8 w-8 text-primary-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-financial-gray-900",children:"Portfolio Manager"}),(0,a.jsx)("p",{className:"text-sm text-financial-gray-500",children:"AI-Powered Investment Management"})]})]}),(0,a.jsxs)("div",{className:"flex space-x-2 bg-gray-50 p-1 rounded-lg",children:[(0,a.jsx)(R,{id:"holdings",label:"Portfolio Holdings",icon:(0,a.jsx)(D.Z,{className:"h-4 w-4"}),isActive:"holdings"===i,onClick:()=>o("holdings")}),(0,a.jsx)(R,{id:"chat",label:"AI Assistant",icon:(0,a.jsx)(H.Z,{className:"h-4 w-4"}),isActive:"chat"===i,onClick:()=>o("chat")})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(U,{}),(0,a.jsx)("div",{className:"h-6 w-px bg-gray-300"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[!c&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-financial-gray-400",children:[(0,a.jsx)(q.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm",children:"API (Auth Required)"})]}),c&&"checking"===e&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-financial-gray-500",children:[(0,a.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-financial-gray-300 border-t-primary-600 rounded-full"}),(0,a.jsx)("span",{className:"text-sm",children:"Checking API..."})]}),c&&"online"===e&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-financial-green",children:[(0,a.jsx)(_.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"API Online"})]}),c&&"offline"===e&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-financial-red",children:[(0,a.jsx)(S.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"API Offline"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[!c&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-financial-gray-400",children:[(0,a.jsx)(A.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm",children:"AI (Auth Required)"})]}),c&&"checking"===s&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-financial-gray-500",children:[(0,a.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-financial-gray-300 border-t-blue-600 rounded-full"}),(0,a.jsx)("span",{className:"text-sm",children:"Checking AI..."})]}),c&&"online"===s&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-blue-600",children:[(0,a.jsx)(A.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"AI Online"})]}),c&&"offline"===s&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-financial-red",children:[(0,a.jsx)(S.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"AI Offline"})]})]})]})]})})}),("offline"===e||"offline"===s&&c||!c&&"chat"===i)&&(0,a.jsx)("div",{className:"flex-shrink-0 px-4 sm:px-6 lg:px-8 pt-4",children:(0,a.jsxs)("div",{className:"space-y-4",children:["offline"===e&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(S.Z,{className:"h-5 w-5 text-red-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-red-800",children:"API Connection Error"}),(0,a.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"Unable to connect to the Portfolio Manager API. Portfolio data may not be available."})]})]})}),!c&&"chat"===i&&(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(A.Z,{className:"h-5 w-5 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-blue-800",children:"Authentication Required"}),(0,a.jsx)("p",{className:"text-xs text-blue-700 mt-1",children:"Please sign in to access the AI assistant and chat functionality."})]})]})}),"offline"===s&&c&&(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(A.Z,{className:"h-5 w-5 text-yellow-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-yellow-800",children:"AI Assistant Unavailable"}),(0,a.jsx)("p",{className:"text-xs text-yellow-700 mt-1",children:"The AI assistant is currently offline. Chat functionality will be limited."})]})]})})]})}),(0,a.jsx)("main",{className:"flex-1 overflow-hidden px-4 sm:px-6 lg:px-8 pt-4 pb-4",children:(0,a.jsxs)("div",{className:"h-full bg-white rounded-xl shadow-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"holdings"===i?"block h-full":"hidden",children:[(0,a.jsx)("div",{className:"bg-gray-50 border-b border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(D.Z,{className:"h-5 w-5 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Portfolio Holdings"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["View and manage your portfolio holdings for Account ",1]})]})]})}),(0,a.jsx)("div",{className:"h-[calc(100%-5rem)] overflow-hidden",children:(0,a.jsx)(p,{})})]}),(0,a.jsxs)("div",{className:"chat"===i?"block h-full":"hidden",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(H.Z,{className:"h-5 w-5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"AI Portfolio Assistant"}),(0,a.jsxs)("p",{className:"text-blue-100 text-sm",children:["Ask questions about your portfolio and get AI-powered insights for Account ",1]})]})]})}),(0,a.jsx)("div",{className:"h-[calc(100%-5rem)] overflow-hidden",children:(0,a.jsx)(E,{accountId:1,isVisible:"chat"===i})})]})]})})]})}},4362:function(e,t,s){"use strict";s.d(t,{AuthContextProvider:function(){return c},a:function(){return d}});var a=s(7437),r=s(2265),l=s(8112),n=s(1001),i=s(3227);let o=(0,r.createContext)(null);function c(e){let{children:t}=e,{instance:s,accounts:c,inProgress:d}=(0,l.Fp)(),m=(0,l.kq)(),[h,x]=(0,r.useState)(null),[u,g]=(0,r.useState)(null),[f,p]=(0,r.useState)(!1);(0,r.useEffect)(()=>{!m||h||f?!m&&h&&b():y()},[m,h,f]);let b=()=>{console.log("Clearing authentication state"),x(null),g(null),i.x.setAccessToken(null)},y=async()=>{var e,t,a,r,l;if(m&&!f){console.log("Starting token acquisition process..."),p(!0);try{let r={...n.Qb,account:c[0]};console.log("Attempting silent token acquisition for scopes:",r.scopes);let l=await s.acquireTokenSilent(r);console.log("Token acquired successfully:",{hasAccessToken:!!l.accessToken,tokenLength:null===(e=l.accessToken)||void 0===e?void 0:e.length,scopes:l.scopes,account:null===(t=l.account)||void 0===t?void 0:t.username}),x(l.accessToken),i.x.setAccessToken(l.accessToken);let o=null===(a=l.account)||void 0===a?void 0:a.idTokenClaims;o&&g({name:o.name||o.preferred_username,email:o.email||o.preferred_username}),console.log("Access token set successfully in API client")}catch(e){console.error("Failed to acquire token silently:",e);try{console.log("Attempting interactive token acquisition...");let e=await s.acquireTokenPopup(n.Qb);console.log("Interactive token acquired:",{hasAccessToken:!!e.accessToken,tokenLength:null===(r=e.accessToken)||void 0===r?void 0:r.length,scopes:e.scopes}),x(e.accessToken),i.x.setAccessToken(e.accessToken);let t=null===(l=e.account)||void 0===l?void 0:l.idTokenClaims;t&&g({name:t.name||t.preferred_username,email:t.email||t.preferred_username}),console.log("Interactive access token set successfully in API client")}catch(e){console.error("Failed to acquire token via popup:",e)}}finally{p(!1)}}},j=async()=>{try{await s.loginPopup(n.Qb)}catch(e){console.error("Login failed:",e)}};return(0,a.jsx)(o.Provider,{value:{isAuthenticated:m&&!!h,isAcquiringToken:f,accessToken:h,userInfo:u,login:j,logout:()=>{console.log("Starting logout process"),b(),s.logoutPopup({postLogoutRedirectUri:window.location.origin})}},children:t})}function d(){let e=(0,r.useContext)(o);if(!e)throw Error("useAuth must be used within an AuthContextProvider");return e}},3227:function(e,t,s){"use strict";s.d(t,{x:function(){return r}});class a{setAccessToken(e){this.accessToken=e}getHeaders(){let e={Accept:"application/json","Content-Type":"application/json"};return this.accessToken?(e.Authorization="Bearer ".concat(this.accessToken),console.log("API request includes auth token (length:",this.accessToken.length,")")):console.warn("API request made WITHOUT auth token"),e}getStreamHeaders(){let e={Accept:"text/plain","Content-Type":"application/json"};return this.accessToken?(e.Authorization="Bearer ".concat(this.accessToken),console.log("Streaming API request includes auth token (length:",this.accessToken.length,")")):console.warn("Streaming API request made WITHOUT auth token"),e}async getHoldings(e){try{let t=this.formatDate(e),s="".concat(this.baseUrl,"/api/holdings/date/").concat(t),a=await fetch(s,{method:"GET",headers:this.getHeaders()});if(!a.ok){let e=await a.text();throw Error("HTTP ".concat(a.status,": ").concat(e))}let r=(await a.json()).holdings||[];return{data:r,message:"Successfully retrieved ".concat(r.length," holdings")}}catch(e){return console.error("Error fetching holdings:",e),{error:e instanceof Error?e.message:"Unknown error occurred"}}}async getHealthStatus(){try{let e="".concat(this.baseUrl,"/health");console.log("Attempting to connect to API health endpoint: ".concat(e)),console.log("Base URL configured as: ".concat(this.baseUrl));let t=await fetch(e);if(!t.ok)throw Error("Health check failed: ".concat(t.status));let s=await t.text();return console.log("API health check successful: ".concat(s)),{data:{status:s},message:"API is healthy"}}catch(e){return console.error("Health check failed:",e),console.error("Base URL was:",this.baseUrl),{error:e instanceof Error?e.message:"Health check failed"}}}formatDate(e){return new Date(e).toISOString().split("T")[0]}formatErrorMessage(e,t){return 401===e?"Please sign in to access the AI Assistant.":403===e?"You do not have permission to access this feature.":500===e&&t.includes("AuthorizationPolicy")?"Authentication required. Please sign in to continue.":e>=500?"The service is currently unavailable. Please try again later.":e>=400&&e<500?"There was a problem with your request. Please check your input and try again.":"HTTP ".concat(e,": ").concat(t)}async testConnection(){return!(await this.getHealthStatus()).error}async sendChatQueryStream(e,t,s,a,r,l){try{var n;let r="".concat(this.baseUrl,"/api/ai/chat/stream");console.log("Sending streaming chat query to: ".concat(r),{threadId:l});let i=await fetch(r,{method:"POST",headers:this.getStreamHeaders(),body:JSON.stringify({query:e,accountId:t,threadId:l})});if(!i.ok){let e=await i.text(),t=this.formatErrorMessage(i.status,e);throw Error(t)}let o=null===(n=i.body)||void 0===n?void 0:n.getReader();if(!o)throw Error("ReadableStream not supported");let c=new TextDecoder;try{for(;;){let{done:e,value:t}=await o.read();if(e){a();break}let r=c.decode(t,{stream:!0});s(r)}}finally{o.releaseLock()}}catch(e){console.error("Error in streaming chat query:",e),r(e instanceof Error?e.message:"Unknown error occurred")}}async sendChatQuery(e,t,s){try{let a="".concat(this.baseUrl,"/api/ai/chat/query");console.log("Sending chat query to: ".concat(a),{threadId:s});let r=await fetch(a,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({query:e,accountId:t,threadId:s})});if(!r.ok){let e=await r.text(),t=this.formatErrorMessage(r.status,e);throw Error(t)}return{data:await r.json(),message:"Chat query processed successfully"}}catch(e){return console.error("Error sending chat query:",e),{error:e instanceof Error?e.message:"Unknown error occurred"}}}async getAvailableAiTools(){try{let e="".concat(this.baseUrl,"/api/ai/chat/tools");console.log("Fetching AI tools from: ".concat(e));let t=await fetch(e,{method:"GET",headers:this.getHeaders()});if(!t.ok){let e=await t.text();throw Error("HTTP ".concat(t.status,": ").concat(e))}let s=await t.json();return{data:s,message:"Successfully retrieved ".concat(s.length," AI tools")}}catch(e){return console.error("Error fetching AI tools:",e),{error:e instanceof Error?e.message:"Unknown error occurred"}}}async getChatHealthStatus(){try{let e="".concat(this.baseUrl,"/api/ai/chat/health");console.log("Checking AI chat health: ".concat(e));let t=await fetch(e,{method:"GET",headers:this.getHeaders()});if(!t.ok)throw Error("AI chat health check failed: ".concat(t.status));return{data:await t.json(),message:"AI chat service is healthy"}}catch(e){return console.error("AI chat health check failed:",e),{error:e instanceof Error?e.message:"AI chat health check failed"}}}constructor(e){var t,s;this.accessToken=null,null===(s=window.location)||void 0===s||null===(t=s.origin)||void 0===t||t.replace("3000","8080"),this.baseUrl=(e||"http://localhost:8080").replace(/\/$/,"")}}let r=new a},1001:function(e,t,s){"use strict";s.d(t,{Qb:function(){return l},XM:function(){return r}});var a=s(1986);let r={auth:{clientId:(()=>{let e="4884728d-b70f-4695-a359-a291ddfa3574";if(!e)throw Error("NEXT_PUBLIC_AZURE_CLIENT_ID environment variable is required. Please set it in your .env.local file.");return e})(),authority:"https://login.microsoftonline.com/".concat((()=>{let e="1f6e5d9e-5f2d-44ae-a729-05e20ecd4f75";if(!e)throw Error("NEXT_PUBLIC_AZURE_TENANT_ID environment variable is required. Please set it in your .env.local file.");return e})()),redirectUri:window.location.origin,postLogoutRedirectUri:window.location.origin},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{loggerCallback:(e,t,s)=>{if(!s)switch(e){case a.i.Error:console.error(t);return;case a.i.Info:console.info(t);return;case a.i.Verbose:console.debug(t);return;case a.i.Warning:console.warn(t);return}}}}},l={scopes:["api://".concat((()=>{let e="78661cad-e894-4462-9d21-5c7d10c56a3e";if(!e)throw Error("NEXT_PUBLIC_AZURE_API_CLIENT_ID environment variable is required. Please set it in your .env.local file.");return e})(),"/Portfolio.ReadWrite")],prompt:"select_account"}}},function(e){e.O(0,[292,884,314,112,639,971,117,744],function(){return e(e.s=3162)}),_N_E=e.O()}]);