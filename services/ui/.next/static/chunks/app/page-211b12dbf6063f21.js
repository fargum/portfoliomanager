(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3162:function(e,t,s){Promise.resolve().then(s.bind(s,9041))},9041:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return K}});var a=s(7437),l=s(2265),n=s(891),r=s(3227),i=s(4362);let o=e=>{let t=e.toLowerCase();return t.includes("hl")||t.includes("hargreaves")?"\uD83C\uDFE6":t.includes("interactive")||t.includes("ib")?"\uD83C\uDF10":t.includes("vanguard")?"⭐":t.includes("fidelity")?"\uD83D\uDC8E":t.includes("schwab")?"\uD83D\uDD37":t.includes("etoro")?"\uD83D\uDCC8":t.includes("degiro")?"\uD83C\uDFAF":t.includes("trading212")||t.includes("212")?"\uD83D\uDCF1":t.includes("freetrade")?"\uD83D\uDE80":t.includes("cash")?"\uD83D\uDCB0":"\uD83D\uDCBC"},c=e=>{let t=e.value||"",s=o(t);return l.createElement("div",{className:"flex items-center space-x-2 h-full",style:{padding:"4px 8px",display:"flex",alignItems:"center"}},[l.createElement("span",{key:"icon",className:"text-lg",style:{fontSize:"18px",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.1))",minWidth:"20px"}},s),l.createElement("span",{key:"name",className:"text-sm font-medium text-financial-slate-700 truncate",style:{maxWidth:"80px"}},t)])},d=e=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:2,maximumFractionDigits:2}).format(e),m=e=>new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:4}).format(e),u=e=>new Date(e).toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"}),x=e=>[{headerName:"",checkboxSelection:!0,headerCheckboxSelection:!0,width:50,minWidth:50,maxWidth:50,resizable:!1,sortable:!1,filter:!1,pinned:"left"},{field:"platformName",headerName:"Platform",width:140,sortable:!0,filter:!0,pinned:"left",cellRenderer:c,cellStyle:{display:"flex",alignItems:"center",padding:"0",backgroundColor:"#fafafa",borderRight:"2px solid #f1f5f9"}},{field:"instrumentName",headerName:"Instrument",width:500,flex:0,sortable:!0,filter:!0,tooltipField:"instrumentName"},{field:"ticker",headerName:"Ticker",width:100,sortable:!0,filter:!0,cellStyle:{fontFamily:"monospace",fontWeight:"bold"}},{field:"instrumentType",headerName:"Type",width:120,sortable:!0,filter:!0,hide:!0},{field:"unitAmount",headerName:"Units",width:120,sortable:!0,filter:"agNumberColumnFilter",type:"numericColumn",editable:!0,cellEditor:"agNumberCellEditor",cellEditorParams:{min:1e-4,max:999999999,precision:4,step:1e-4},valueFormatter:e=>m(e.value),cellStyle:e=>{var t;return{textAlign:"right",fontFamily:"monospace",backgroundColor:(null===(t=e.node)||void 0===t?void 0:t.isRowPinned())?"transparent":"#f8fafc",border:"1px solid #e2e8f0",cursor:"pointer"}},onCellValueChanged:e,cellClass:"editable-cell"},{field:"boughtValue",headerName:"Bought Value",width:130,sortable:!0,filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:e=>d(e.value),cellStyle:{textAlign:"right",fontFamily:"monospace"}},{field:"currentValue",headerName:"Current Value",width:140,sortable:!0,filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:e=>d(e.value),cellStyle:e=>({textAlign:"right",fontFamily:"monospace",fontWeight:"bold",color:e.value>0?"#10b981":"#ef4444"})},{field:"gainLoss",headerName:"Gain/Loss",width:130,sortable:!0,filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:e=>d(e.value),cellStyle:e=>({textAlign:"right",fontFamily:"monospace",fontWeight:"bold",color:e.value>=0?"#10b981":"#ef4444"})},{field:"gainLossPercentage",headerName:"Gain/Loss %",width:120,sortable:!0,filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:e=>"".concat(m(e.value),"%"),cellStyle:e=>({textAlign:"right",fontFamily:"monospace",fontWeight:"bold",color:e.value>=0?"#10b981":"#ef4444"})},{field:"dailyProfitLoss",headerName:"Daily P/L",width:120,sortable:!0,filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:e=>d(e.value),cellStyle:e=>({textAlign:"right",fontFamily:"monospace",fontWeight:"bold",color:e.value>=0?"#10b981":"#ef4444",backgroundColor:e.value>=0?"#f0f9ff":"#fef2f2"})},{field:"dailyProfitLossPercentage",headerName:"Daily P/L %",width:120,sortable:!0,filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:e=>"".concat(m(e.value),"%"),cellStyle:e=>({textAlign:"right",fontFamily:"monospace",fontWeight:"bold",color:e.value>=0?"#10b981":"#ef4444",backgroundColor:e.value>=0?"#f0f9ff":"#fef2f2"})},{field:"valuationDate",headerName:"Valuation Date",width:140,sortable:!0,filter:"agDateColumnFilter",valueFormatter:e=>u(e.value)}],h=e=>e.reduce((e,t)=>e+t.currentValue,0),f=e=>e.reduce((e,t)=>e+t.boughtValue,0),g=e=>e.reduce((e,t)=>e+t.gainLoss,0),b=e=>{if(0===e.length)return 0;let t=f(e),s=g(e);return 0!==t?s/t*100:0},p=e=>e.reduce((e,t)=>e+t.dailyProfitLoss,0),j=e=>{if(0===e.length)return 0;let t=p(e),s=h(e);return 0!==s?t/s*100:0};var N=s(370),y=s(1047),v=s(1804),w=s(525),k=s(3085),C=s(4401),S=s(7168),D=s(9397),I=s(8930),F=s(1239),A=s(2489);s(4868),s(3893);let P=()=>{let{userInfo:e}=(0,i.a)(),[t,s]=(0,l.useState)([]),o=(0,l.useRef)([]),[c,m]=(0,l.useState)(!1),[u,A]=(0,l.useState)(null),[P,E]=(0,l.useState)(new Set),[Z,L]=(0,l.useState)([]),[q,T]=(0,l.useState)(!1),[z,B]=(0,l.useState)(!1),[R,G]=(0,l.useState)(!1),[H,V]=(0,l.useState)(new Date().toISOString().split("T")[0]),[W,M]=(0,l.useState)(0),[O,_]=(0,l.useState)(0),[Y,J]=(0,l.useState)(null),[Q,$]=(0,l.useState)(!1),[K,X]=(0,l.useState)([]),ee=(0,l.useCallback)(async()=>{m(!0),A(null);try{let e=await r.x.getHoldings(H);e.error?(A(e.error),s([]),o.current=[]):(s(e.data||[]),o.current=e.data||[])}catch(e){A("Failed to fetch holdings"),s([]),o.current=[]}finally{m(!1)}},[H]),et=(0,l.useCallback)(()=>{if(!Y)return;let e=0,t=0;Y.forEachNodeAfterFilter(s=>{s.data&&(e+=s.data.currentValue||0,t++)}),M(e),_(t)},[Y]),es=(0,l.useCallback)(e=>{J(e.api),setTimeout(()=>{let t=0,s=0;e.api.forEachNodeAfterFilter(e=>{e.data&&(t+=e.data.currentValue||0,s++)}),M(t),_(s)},100)},[]),ea=(0,l.useCallback)(()=>{et()},[et]);(0,l.useEffect)(()=>{et()},[t,et]);let el=(0,l.useCallback)(async e=>{let{data:t,newValue:s,oldValue:a,colDef:l}=e;if("unitAmount"!==l.field||s===a)return;if(s<=0||isNaN(s)){A("Units must be a positive number"),t.unitAmount=a,e.api.refreshCells({rowNodes:[e.node],force:!0});return}let n=t.holdingId;try{E(e=>new Set([...Array.from(e),n]));let l=await r.x.updateHoldingUnits(n,s);if(l.error)A("Failed to update units: ".concat(l.error)),t.unitAmount=a,e.api.refreshCells({rowNodes:[e.node],force:!0});else{await ee();let e="Successfully updated ".concat(t.ticker," units to ").concat(s.toFixed(4));console.log(e),setTimeout(()=>{u===e&&A(null)},3e3)}}catch(s){A("Error updating units: ".concat(s instanceof Error?s.message:"Unknown error")),t.unitAmount=a,e.api.refreshCells({rowNodes:[e.node],force:!0})}finally{E(e=>{let t=new Set(Array.from(e));return t.delete(n),t})}},[ee,u]),en=(0,l.useCallback)(e=>{L(e.api.getSelectedRows())},[]),er=(0,l.useCallback)(async()=>{if(0===Z.length)return;let e="Are you sure you want to delete ".concat(Z.length," holding").concat(Z.length>1?"s":"","?\n\nThis will permanently remove:\n").concat(Z.map(e=>"• ".concat(e.ticker," (").concat(e.unitAmount.toFixed(4)," units)")).slice(0,5).join("\n")).concat(Z.length>5?"\n• ... and ".concat(Z.length-5," more"):"");if(!window.confirm(e))return;T(!0);let t=Z.map(e=>e.holdingId),s=[],a=0;try{for(let e of t)try{let t=await r.x.deleteHolding(e);if(t.error){let a=Z.find(t=>t.holdingId===e);s.push("".concat((null==a?void 0:a.ticker)||e,": ").concat(t.error))}else a++}catch(a){let t=Z.find(t=>t.holdingId===e);s.push("".concat((null==t?void 0:t.ticker)||e,": ").concat(a instanceof Error?a.message:"Unknown error"))}a>0&&console.log("Successfully deleted ".concat(a," holding").concat(a>1?"s":"")),s.length>0?A("Failed to delete some holdings:\n".concat(s.slice(0,3).join("\n")).concat(s.length>3?"\n... and ".concat(s.length-3," more errors"):"")):a>0&&A(null),await ee(),L([])}finally{T(!1)}},[Z,ee]),ei=(0,l.useCallback)(async e=>{G(!0);try{A(null);let t=o.current;if(0===t.length)return A("No existing holdings found. Portfolio ID cannot be determined."),!1;let s=t[0].portfolioId,a=await r.x.addHolding(s,{platformId:e.platformId,ticker:e.ticker,units:e.units,boughtValue:0,instrumentName:e.ticker,description:e.description||"".concat(e.ticker," holding"),currencyCode:e.currencyCode||"GBP",quoteUnit:e.quoteUnit||"GBP"});if(a.error)return A("Failed to add holding: ".concat(a.error)),!1;return await ee(),A(null),!0}catch(e){return A("Error adding holding: ".concat(e instanceof Error?e.message:"Unknown error")),!1}finally{G(!1)}},[t,ee]);(0,l.useEffect)(()=>{ee()},[ee]);let eo=h(t);f(t);let ec=g(t),ed=b(t),em=p(t),eu=j(t);return t.length,(0,a.jsxs)("div",{className:"w-full h-full bg-transparent flex flex-col",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-financial-blue-600 via-financial-indigo-600 to-financial-purple-600 px-4 py-3 text-white relative overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent transform -skew-x-12 translate-x-full animate-pulse"}),(0,a.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full transform translate-x-16 -translate-y-16"}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full transform -translate-x-12 translate-y-12"}),(0,a.jsxs)("div",{className:"relative flex items-center justify-between z-10",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-financial-emerald-400 rounded-lg opacity-20 animate-pulse"}),(0,a.jsx)(N.Z,{className:"h-6 w-6 relative z-10 filter drop-shadow-md"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-bold tracking-wide",children:"Portfolio Holdings"}),(0,a.jsx)("p",{className:"text-blue-100 text-sm font-medium",children:(()=>{var t;let s=(null==e?void 0:null===(t=e.name)||void 0===t?void 0:t.split(" ")[0])||"Your";return"Your"===s?"Your Portfolio":"".concat(s,"'s Portfolio")})()})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 bg-white/20 backdrop-blur-sm rounded-lg px-3 py-2 border border-white/30",children:[(0,a.jsx)(y.Z,{className:"h-4 w-4 text-blue-200"}),(0,a.jsx)("input",{type:"date",value:H,onChange:e=>V(e.target.value),className:"bg-transparent border-0 text-white text-sm focus:outline-none placeholder-blue-200 font-medium"})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsxs)("div",{className:"flex items-baseline space-x-6",children:[(0,a.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg px-3 py-2 border border-white/20",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,a.jsx)(v.Z,{className:"h-3 w-3 text-blue-200"}),(0,a.jsxs)("p",{className:"text-xs text-blue-100 font-medium uppercase tracking-wide",children:[O!==t.length?"Filtered":"Total"," Value"]})]}),(0,a.jsx)("p",{className:"text-xl font-bold tracking-tight",children:d(W>0?W:eo)}),O!==t.length&&(0,a.jsxs)("p",{className:"text-xs text-blue-200 font-medium",children:["Total: ",d(eo)]})]}),(0,a.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg px-3 py-2 border border-white/20",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[ec>=0?(0,a.jsx)(w.Z,{className:"h-3 w-3 text-green-200"}):(0,a.jsx)(k.Z,{className:"h-3 w-3 text-red-200"}),(0,a.jsx)("p",{className:"text-xs text-blue-100 font-medium uppercase tracking-wide",children:"Total P&L"})]}),(0,a.jsx)("p",{className:"text-sm font-bold ".concat(ec>=0?"text-green-200":"text-red-200"),children:d(ec)}),(0,a.jsxs)("p",{className:"text-xs ".concat(ed>=0?"text-green-200":"text-red-200"," font-medium"),children:["(",ed>=0?"+":"",ed.toFixed(2),"%)"]})]}),(0,a.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg px-3 py-2 border border-white/20",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,a.jsx)(C.Z,{className:"h-3 w-3 text-yellow-200"}),(0,a.jsx)("p",{className:"text-xs text-blue-100 font-medium uppercase tracking-wide",children:"Daily P&L"})]}),(0,a.jsx)("p",{className:"text-sm font-bold ".concat(em>=0?"text-green-200":"text-red-200"),children:d(em)}),(0,a.jsxs)("p",{className:"text-xs ".concat(eu>=0?"text-green-200":"text-red-200"," font-medium"),children:["(",eu>=0?"+":"",eu.toFixed(2),"%)"]})]})]})}),(0,a.jsxs)("button",{onClick:ee,disabled:c,className:"group flex items-center space-x-2 bg-white/20 hover:bg-white/30 backdrop-blur-sm px-3 py-2 rounded-lg border border-white/30 transition-all duration-300 transform hover:scale-105 shadow-lg",children:[(0,a.jsx)(S.Z,{className:"h-4 w-4 transition-transform duration-300 ".concat(c?"animate-spin":"group-hover:rotate-180")}),(0,a.jsx)("span",{className:"text-sm font-semibold",children:"Refresh"})]}),(0,a.jsxs)("button",{onClick:()=>{A(null),B(!0)},disabled:c||P.size>0||q,className:"group flex items-center space-x-2 bg-financial-emerald-500/30 hover:bg-financial-emerald-400/40 disabled:bg-financial-emerald-500/10 backdrop-blur-sm px-3 py-2 rounded-lg border border-financial-emerald-400/30 transition-all duration-300 transform hover:scale-105 disabled:cursor-not-allowed shadow-lg",children:[(0,a.jsx)(D.Z,{className:"h-4 w-4 transition-transform duration-300 group-hover:rotate-90"}),(0,a.jsx)("span",{className:"text-sm font-semibold",children:"Add"})]}),Z.length>0&&(0,a.jsx)("button",{onClick:er,disabled:q||P.size>0,className:"group flex items-center space-x-2 bg-financial-rose-500/30 hover:bg-financial-rose-400/40 disabled:bg-financial-rose-500/10 backdrop-blur-sm px-3 py-2 rounded-lg border border-financial-rose-400/30 transition-all duration-300 transform hover:scale-105 disabled:cursor-not-allowed shadow-lg",children:q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,a.jsx)("span",{className:"text-sm font-semibold",children:"Deleting..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I.Z,{className:"h-4 w-4 transition-transform duration-300 group-hover:scale-110"}),(0,a.jsxs)("span",{className:"text-sm font-semibold",children:["Delete ",Z.length]})]})}),P.size>0&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 bg-financial-amber-500/20 backdrop-blur-sm px-3 py-2 rounded-lg border border-financial-amber-400/30 shadow-lg",children:[(0,a.jsx)(F.Z,{className:"animate-pulse h-4 w-4 text-amber-200"}),(0,a.jsxs)("span",{className:"text-sm font-semibold",children:["Updating ",P.size," holding",P.size>1?"s":"","..."]})]})]})]})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:[u&&(0,a.jsx)("div",{className:"mx-4 mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-red-700",children:[(0,a.jsx)("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),(0,a.jsxs)("span",{className:"font-medium text-sm",children:["Error: ",u]})]})}),(0,a.jsx)("div",{className:"flex-1 w-full px-4 pb-4",children:(0,a.jsx)("div",{className:"ag-theme-alpine w-full h-full",children:(0,a.jsx)(n.s,{rowData:t,columnDefs:x(el),onGridReady:es,onFilterChanged:ea,onSelectionChanged:en,defaultColDef:{sortable:!0,filter:!0,resizable:!0,minWidth:120,flex:1},singleClickEdit:!0,stopEditingWhenCellsLoseFocus:!0,rowSelection:"multiple",suppressRowClickSelection:!1,enableRangeSelection:!0,aggFuncs:{sum:e=>e.values.filter(e=>null!=e&&!isNaN(e)).reduce((e,t)=>e+t,0),avg:e=>{let t=e.values.filter(e=>null!=e&&!isNaN(e));return 0===t.length?0:t.reduce((e,t)=>e+t,0)/t.length},count:e=>e.values.filter(e=>null!=e).length},pagination:!0,paginationPageSize:50,suppressHorizontalScroll:!1,alwaysShowHorizontalScroll:!1,suppressColumnVirtualisation:!1,maintainColumnOrder:!0})})}),t.length>0&&(0,a.jsx)("div",{className:"px-4 pb-4 flex-shrink-0",children:(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg p-3",children:(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsxs)("span",{children:["Showing ",O," of ",t.length," holdings",O!==t.length&&(0,a.jsx)("span",{className:"text-blue-600 font-medium",children:" (filtered)"})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-6",children:[O!==t.length&&(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["Total Portfolio: ",d(eo)]}),(0,a.jsxs)("span",{className:"font-semibold",children:[O!==t.length?"Filtered":"Total"," Value:",(0,a.jsx)("span",{className:"text-green-600 text-base ml-1",children:d(W>0?W:eo)})]}),(0,a.jsxs)("span",{className:"font-semibold",children:["Total P&L:",(0,a.jsxs)("span",{className:"text-base ml-1 ".concat(ec>=0?"text-green-600":"text-red-600"),children:[d(ec)," (",ed>=0?"+":"",ed.toFixed(2),"%)"]})]}),(0,a.jsxs)("span",{className:"font-semibold",children:["Daily P&L:",(0,a.jsxs)("span",{className:"text-base ml-1 ".concat(em>=0?"text-green-600":"text-red-600"),children:[d(em)," (",eu>=0?"+":"",eu.toFixed(2),"%)"]})]})]})]})})})]}),z&&(0,a.jsx)(U,{isOpen:z,onClose:()=>B(!1),onSubmit:ei,isSubmitting:R,availablePlatforms:Array.from(new Map(t.map(e=>[e.platformId,{id:e.platformId,name:e.platformName}])).values()).sort((e,t)=>e.name.localeCompare(t.name))})]})},U=e=>{let{isOpen:t,onClose:s,onSubmit:n,isSubmitting:i,availablePlatforms:o}=e,[c,d]=(0,l.useState)("ticker"),[m,u]=(0,l.useState)(""),[x,h]=(0,l.useState)(null),[f,g]=(0,l.useState)(!1),[b,p]=(0,l.useState)({units:"",platformId:o.length>0?o[0].id.toString():"",currencyCode:"GBP",quoteUnit:"GBP",description:""});(0,l.useEffect)(()=>{o.length>0&&!b.platformId&&p(e=>({...e,platformId:o[0].id.toString()}))},[o,b.platformId]);let[j,N]=(0,l.useState)({}),y=async e=>{if(e.trim()){g(!0),N({});try{var t,s;let a=await r.x.checkInstrument(e.trim().toUpperCase());if(a.error){N({ticker:a.error});return}h((null===(t=a.data)||void 0===t?void 0:t.exists)||!1),d("details"),(null===(s=a.data)||void 0===s?void 0:s.exists)||p(t=>({...t,description:"".concat(e.toUpperCase()," holdings")}))}catch(e){N({ticker:"Failed to check instrument"})}finally{g(!1)}}},v=()=>{let e={},t=parseFloat(b.units);!b.units.trim()||isNaN(t)||t<=0?e.units="Units must be a positive number":t>999999999&&(e.units="Units cannot exceed 999,999,999");let s=parseInt(b.platformId);return!b.platformId.trim()||isNaN(s)||s<=0?e.platformId="Please select a platform":o.length>0&&!o.find(e=>e.id===s)&&(e.platformId="Selected platform is not valid"),x||(b.currencyCode.trim()||(e.currencyCode="Currency is required for new instruments"),b.quoteUnit.trim()||(e.quoteUnit="Quote unit is required for new instruments")),N(e),0===Object.keys(e).length},w=async e=>{e.preventDefault(),v()&&await n({ticker:m.trim().toUpperCase(),units:parseFloat(b.units),platformId:parseInt(b.platformId),description:b.description,currencyCode:b.currencyCode,quoteUnit:b.quoteUnit})&&k()},k=()=>{i||(d("ticker"),u(""),h(null),p({units:"",platformId:o.length>0?o[0].id.toString():"",currencyCode:"GBP",quoteUnit:"GBP",description:""}),N({}),s())};return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Add New Holding"}),(0,a.jsx)("button",{onClick:k,disabled:i,className:"text-gray-400 hover:text-gray-600 disabled:cursor-not-allowed",children:(0,a.jsx)(A.Z,{className:"h-6 w-6"})})]}),(0,a.jsxs)("form",{onSubmit:"ticker"===c?e=>{if(e.preventDefault(),!m.trim()){N({ticker:"Ticker is required"});return}if(!/^[A-Za-z0-9.\\-_]+$/.test(m.trim())){N({ticker:"Invalid ticker format"});return}y(m)}:w,className:"space-y-4",children:["ticker"===c&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"ticker",className:"block text-sm font-medium text-gray-700 mb-1",children:"Ticker Symbol *"}),(0,a.jsx)("input",{type:"text",id:"ticker",value:m,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(j.ticker?"border-red-500":"border-gray-300"),placeholder:"e.g., AAPL, MSFT, TSLA",disabled:f,maxLength:20}),j.ticker&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:j.ticker}),(0,a.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"Enter the ticker symbol to check if the instrument exists in our system"})]}),(0,a.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:k,disabled:f,className:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed disabled:bg-gray-100",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:f||!m.trim(),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-blue-400 disabled:cursor-not-allowed flex items-center justify-center",children:f?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Checking..."]}):"Next"})]})]}),"details"===c&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-md",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:m}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:x?(0,a.jsx)(a.Fragment,{children:"✅ Instrument exists in our system"}):(0,a.jsx)(a.Fragment,{children:"⚠️ New instrument - additional details required"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"units",className:"block text-sm font-medium text-gray-700 mb-1",children:"Number of Units *"}),(0,a.jsx)("input",{type:"number",id:"units",value:b.units,onChange:e=>p({...b,units:e.target.value}),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(j.units?"border-red-500":"border-gray-300"),placeholder:"0.0000",disabled:i,min:"0.0001",max:"999999999",step:"0.0001",autoFocus:!0}),j.units&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:j.units})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"platformId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Platform *"}),(0,a.jsx)("select",{id:"platformId",value:b.platformId,onChange:e=>p({...b,platformId:e.target.value}),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(j.platformId?"border-red-500":"border-gray-300"),disabled:i,children:0===o.length?(0,a.jsx)("option",{value:"",children:"No platforms available"}):o.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))}),j.platformId&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:j.platformId}),(0,a.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"Choose from platforms where you already have holdings"})]}),!x&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"currencyCode",className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency *"}),(0,a.jsxs)("select",{id:"currencyCode",value:b.currencyCode,onChange:e=>p({...b,currencyCode:e.target.value}),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(j.currencyCode?"border-red-500":"border-gray-300"),disabled:i,children:[(0,a.jsx)("option",{value:"GBP",children:"GBP (British Pound)"}),(0,a.jsx)("option",{value:"USD",children:"USD (US Dollar)"}),(0,a.jsx)("option",{value:"EUR",children:"EUR (Euro)"}),(0,a.jsx)("option",{value:"JPY",children:"JPY (Japanese Yen)"}),(0,a.jsx)("option",{value:"CAD",children:"CAD (Canadian Dollar)"}),(0,a.jsx)("option",{value:"AUD",children:"AUD (Australian Dollar)"})]}),j.currencyCode&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:j.currencyCode})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"quoteUnit",className:"block text-sm font-medium text-gray-700 mb-1",children:"Quote Unit *"}),(0,a.jsxs)("select",{id:"quoteUnit",value:b.quoteUnit,onChange:e=>p({...b,quoteUnit:e.target.value}),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(j.quoteUnit?"border-red-500":"border-gray-300"),disabled:i,children:[(0,a.jsx)("option",{value:"GBP",children:"GBP (British Pound)"}),(0,a.jsx)("option",{value:"USD",children:"USD (US Dollar)"}),(0,a.jsx)("option",{value:"EUR",children:"EUR (Euro)"}),(0,a.jsx)("option",{value:"JPY",children:"JPY (Japanese Yen)"}),(0,a.jsx)("option",{value:"CAD",children:"CAD (Canadian Dollar)"}),(0,a.jsx)("option",{value:"AUD",children:"AUD (Australian Dollar)"})]}),j.quoteUnit&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:j.quoteUnit})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,a.jsx)("input",{type:"text",id:"description",value:b.description,onChange:e=>p({...b,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional description for this instrument",disabled:i,maxLength:255})]})]}),(0,a.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{d("ticker"),h(null),N({})},disabled:i,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed disabled:bg-gray-100",children:"Back"}),(0,a.jsx)("button",{type:"button",onClick:k,disabled:i,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed disabled:bg-gray-100",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:i,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-blue-400 disabled:cursor-not-allowed flex items-center justify-center",children:i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Adding..."]}):"Add Holding"})]})]})]})]})})}):null};var E=s(236),Z=s(3260),L=s(5846),q=s(2369),T=s(2222),z=s(9322),B=s(1723),R=s(9090),G=s(4743);function H(e){let{accountId:t,className:s="",isVisible:n=!0}=e,[o,c]=(0,l.useState)(""),[d,m]=(0,l.useState)(void 0),{isAuthenticated:u,login:x}=(0,i.a)(),[h,f]=(0,l.useState)({messages:[{id:"1",type:"system",content:'Welcome! I\'m your AI portfolio assistant. Ask me anything about your portfolio, such as:\n        \n• "How is my portfolio performing today?"\n• "What are my top holdings?"\n• "Show me market sentiment for my stocks"\n• "Compare my performance from last week"\n        \nI can analyze your holdings, market conditions, and provide insights to help you make informed decisions.',timestamp:new Date}],isLoading:!1}),g=(0,l.useRef)(null),b=(0,l.useRef)(null),p=()=>{var e;null===(e=g.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,l.useEffect)(()=>{p()},[h.messages]),(0,l.useEffect)(()=>{n&&setTimeout(()=>p(),100)},[n]),(0,l.useEffect)(()=>{m(void 0),f({messages:[{id:"1",type:"system",content:'Welcome! I\'m your AI portfolio assistant. Ask me anything about your portfolio, such as:\n        \n• "How is my portfolio performing today?"\n• "What are my top holdings?"\n• "Show me market sentiment for my stocks"\n• "Compare my performance from last week"\n        \nI can analyze your holdings, market conditions, and provide insights to help you make informed decisions.',timestamp:new Date}],isLoading:!1})},[t]);let j=()=>"msg_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),N=async e=>{if(e.preventDefault(),!o.trim()||h.isLoading)return;let s={id:j(),type:"user",content:o.trim(),timestamp:new Date},a=j(),l={id:a,type:"ai",content:"",timestamp:new Date,isLoading:!0};f(e=>({...e,messages:[...e.messages,s,l],isLoading:!0}));let n=o.trim();c("");let i="",u=!0;try{await r.x.sendChatQueryStream(n,t,e=>{i+=e,f(e=>({...e,messages:e.messages.map(e=>e.id===a?{...e,content:i,isLoading:!1,statusMessage:void 0}:e)}))},()=>{f(e=>({...e,isLoading:!1,error:void 0}))},async e=>{console.warn("Streaming failed, falling back to regular API:",e),u=!1;try{var s,l,i,o,c;let e=await r.x.sendChatQuery(n,t,d);if(e.error)throw Error(e.error);(null===(s=e.data)||void 0===s?void 0:s.threadId)&&!d&&m(e.data.threadId);let u={id:a,type:"ai",content:(null===(l=e.data)||void 0===l?void 0:l.response)||"I apologize, but I couldn't process your request.",timestamp:new Date,queryType:null===(i=e.data)||void 0===i?void 0:i.queryType,portfolioSummary:null===(o=e.data)||void 0===o?void 0:o.portfolioSummary,insights:null===(c=e.data)||void 0===c?void 0:c.insights};f(e=>({...e,messages:e.messages.map(e=>e.id===a?u:e),isLoading:!1,error:void 0}))}catch(t){let e={id:a,type:"ai",content:"I apologize, but I encountered an error: ".concat(t instanceof Error?t.message:"Unknown error"),timestamp:new Date,error:t instanceof Error?t.message:"Unknown error"};f(s=>({...s,messages:s.messages.map(t=>t.id===a?e:t),isLoading:!1,error:t instanceof Error?t.message:"Unknown error"}))}},e=>{f(t=>({...t,messages:t.messages.map(t=>t.id===a?{...t,statusMessage:e.Message,isLoading:!0}:t)}))},d)}catch(t){if(!u)return;let e={id:a,type:"ai",content:"I apologize, but I encountered an error: ".concat(t instanceof Error?t.message:"Unknown error"),timestamp:new Date,error:t instanceof Error?t.message:"Unknown error"};f(s=>({...s,messages:s.messages.map(t=>t.id===a?e:t),isLoading:!1,error:t instanceof Error?t.message:"Unknown error"}))}},y=e=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:2}).format(e),v=e=>"".concat(e>=0?"+":"").concat((100*e).toFixed(2),"%"),S=(e,t)=>(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mt-2",children:(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)(L.Z,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-900 text-sm",children:e.title}),(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("High"===e.impact?"bg-red-100 text-red-800":"Medium"===e.impact?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.impact})]}),(0,a.jsx)("p",{className:"text-blue-800 text-sm mt-1",children:e.description}),(0,a.jsx)("span",{className:"text-blue-600 text-xs mt-1 block",children:e.category})]})]})},t),D=e=>(0,a.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mt-3",children:[(0,a.jsxs)("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[(0,a.jsx)(C.Z,{className:"h-4 w-4 mr-2"}),"Portfolio Summary"]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Total Value"}),(0,a.jsx)("p",{className:"font-bold text-lg",children:y(e.totalValue)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Day Change"}),(0,a.jsxs)("p",{className:"font-bold text-lg flex items-center ".concat(e.dayChange>=0?"text-green-600":"text-red-600"),children:[e.dayChange>=0?(0,a.jsx)(w.Z,{className:"h-4 w-4 mr-1"}):(0,a.jsx)(k.Z,{className:"h-4 w-4 mr-1"}),y(e.dayChange)," (",v(e.dayChangePercentage),")"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Holdings Count"}),(0,a.jsx)("p",{className:"font-bold",children:e.holdingsCount})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Date"}),(0,a.jsx)("p",{className:"font-bold",children:new Date(e.date).toLocaleDateString()})]})]}),e.topHoldings&&e.topHoldings.length>0&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Top Holdings"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.topHoldings.map((e,t)=>(0,a.jsx)("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium",children:e},t))})]})]});return(0,a.jsx)("div",{className:"flex flex-col h-full bg-white ".concat(s),children:u?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 bg-gradient-to-br from-white to-financial-slate-50/30",children:[h.messages.map(e=>{let t="user"===e.type,s="system"===e.type;return(0,a.jsx)("div",{className:"flex ".concat(t?"justify-end":"justify-start"," mb-6"),children:(0,a.jsxs)("div",{className:"flex items-start space-x-3 max-w-[95%] ".concat(t?"flex-row-reverse space-x-reverse":""),children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-xl flex items-center justify-center shadow-lg ".concat(t?"bg-gradient-to-br from-financial-blue-500 to-financial-indigo-600 text-white":s?"bg-gradient-to-br from-financial-slate-500 to-financial-slate-600 text-white":"bg-gradient-to-br from-financial-emerald-500 to-financial-emerald-600 text-white"),children:t?(0,a.jsx)(q.Z,{className:"h-5 w-5"}):(0,a.jsx)(T.Z,{className:"h-5 w-5"})}),(0,a.jsx)("div",{className:"rounded-2xl px-5 py-4 shadow-lg border backdrop-blur-sm ".concat(t?"bg-gradient-to-br from-financial-blue-600 to-financial-indigo-600 text-white border-financial-blue-200":s?"bg-gradient-to-br from-financial-slate-50 to-white text-financial-slate-800 border-financial-slate-200":e.error?"bg-gradient-to-br from-financial-rose-50 to-white text-financial-rose-800 border-financial-rose-200":"bg-gradient-to-br from-white to-financial-slate-50/30 text-financial-slate-800 border-financial-slate-200"),children:e.isLoading?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-gray-300 border-t-blue-600 rounded-full"}),(0,a.jsx)("span",{className:"text-sm",children:e.statusMessage||"Thinking..."})]}):(0,a.jsxs)(a.Fragment,{children:[e.error&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,a.jsx)(z.Z,{className:"h-4 w-4 text-red-600"}),(0,a.jsx)("span",{className:"text-sm font-medium text-red-800",children:"Error"})]}),(0,a.jsx)("div",{className:"max-w-none",children:t?(0,a.jsx)("div",{className:"whitespace-pre-wrap text-white",children:e.content}):(0,a.jsx)(E.UG,{remarkPlugins:[Z.Z],components:{table:e=>{let{children:t}=e;return(0,a.jsx)("div",{className:"chat-table-container",children:(0,a.jsx)("table",{className:"chat-table",children:t})})},thead:e=>{let{children:t}=e;return(0,a.jsx)("thead",{children:t})},tbody:e=>{let{children:t}=e;return(0,a.jsx)("tbody",{children:t})},tr:e=>{let{children:t}=e;return(0,a.jsx)("tr",{children:t})},th:e=>{let{children:t}=e;return(0,a.jsx)("th",{children:t})},td:e=>{let{children:t}=e;return(0,a.jsx)("td",{children:t})},h1:e=>{let{children:t}=e;return(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-3",children:t})},h2:e=>{let{children:t}=e;return(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:t})},h3:e=>{let{children:t}=e;return(0,a.jsx)("h3",{className:"text-md font-medium text-gray-900 mb-2",children:t})},p:e=>{let{children:t}=e;return(0,a.jsx)("p",{className:"mb-2 text-gray-800",children:t})},strong:e=>{let{children:t}=e;return(0,a.jsx)("strong",{className:"font-semibold text-gray-900",children:t})},ul:e=>{let{children:t}=e;return(0,a.jsx)("ul",{className:"list-disc list-outside mb-2 ml-4 space-y-0",children:t})},ol:e=>{let{children:t}=e;return(0,a.jsx)("ol",{className:"list-decimal list-outside mb-2 ml-4 space-y-0",children:t})},li:e=>{let{children:t}=e;return(0,a.jsx)("li",{className:"text-gray-800 mb-1",children:t})},code:e=>{var t;let{children:s,...l}=e;return(null===(t=l.className)||void 0===t?void 0:t.includes("inline"))||!l.className?(0,a.jsx)("code",{className:"bg-gray-100 text-gray-800 px-1 py-0.5 rounded text-sm font-mono",children:s}):(0,a.jsx)("pre",{className:"bg-gray-100 text-gray-800 p-3 rounded-lg overflow-x-auto",children:(0,a.jsx)("code",{className:"text-sm font-mono",children:s})})},blockquote:e=>{let{children:t}=e;return(0,a.jsx)("blockquote",{className:"border-l-4 border-blue-500 pl-4 italic text-gray-700 my-2",children:t})},a:e=>{let{href:t,children:s}=e;return(0,a.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline font-medium",children:s})}},children:e.content})}),e.portfolioSummary&&D(e.portfolioSummary),e.insights&&e.insights.length>0&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsxs)("h4",{className:"font-medium text-gray-900 mb-2 flex items-center",children:[(0,a.jsx)(L.Z,{className:"h-4 w-4 mr-2"}),"Insights"]}),e.insights.map(S)]}),(0,a.jsxs)("div",{className:"text-xs mt-2 flex items-center ".concat(t?"text-blue-200":"text-gray-500"),children:[(0,a.jsx)(B.Z,{className:"h-3 w-3 mr-1"}),e.timestamp.toLocaleTimeString(),e.queryType&&(0,a.jsx)("span",{className:"ml-2 bg-gray-200 text-gray-700 px-2 py-0.5 rounded-full",children:e.queryType})]})]})})]})},e.id)}),(0,a.jsx)("div",{ref:g})]}),(0,a.jsxs)("div",{className:"border-t border-financial-slate-200 p-4 bg-white/95 backdrop-blur-sm",children:[(0,a.jsxs)("form",{onSubmit:N,className:"flex space-x-3",children:[(0,a.jsx)("input",{ref:b,type:"text",value:o,onChange:e=>c(e.target.value),placeholder:"Ask me about your portfolio...",disabled:h.isLoading,className:"flex-1 border border-financial-slate-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-financial-blue-500 focus:border-transparent disabled:bg-financial-slate-100 disabled:cursor-not-allowed text-base text-financial-slate-800 placeholder-financial-slate-500 shadow-sm"}),(0,a.jsx)("button",{type:"submit",disabled:h.isLoading||!o.trim(),className:"bg-gradient-to-r from-financial-blue-600 to-financial-indigo-600 text-white px-6 py-3 rounded-xl hover:from-financial-blue-700 hover:to-financial-indigo-700 disabled:from-financial-slate-400 disabled:to-financial-slate-400 disabled:cursor-not-allowed transition-all duration-300 transform hover:scale-105 shadow-lg font-medium",children:(0,a.jsx)(G.Z,{className:"h-5 w-5"})})]}),h.error&&(0,a.jsxs)("div",{className:"mt-3 text-sm text-red-600 flex items-center justify-between bg-red-50 p-3 rounded-lg border border-red-200",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(z.Z,{className:"h-4 w-4 mr-2 flex-shrink-0"}),(0,a.jsx)("span",{children:h.error})]}),(h.error.includes("sign in")||h.error.includes("Authentication"))&&(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"ml-3 bg-blue-600 text-white px-3 py-1 rounded-md text-xs hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})]})]}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center p-8",children:(0,a.jsxs)("div",{className:"text-center max-w-md",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)(T.Z,{className:"h-10 w-10 text-blue-600"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"AI Assistant Ready"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Sign in to access your AI portfolio assistant and get personalized insights about your investments."}),(0,a.jsxs)("button",{onClick:x,className:"inline-flex items-center space-x-2 bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 transition-colors font-medium",children:[(0,a.jsx)(R.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Sign In to Start"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-4",children:"Once authenticated, you can ask questions about your portfolio performance, holdings, and get market insights."})]})})})}var V=s(8112),W=s(8906),M=s(7692);function O(){let{inProgress:e}=(0,V.Fp)(),{isAuthenticated:t,isAcquiringToken:s,accessToken:l,userInfo:n,login:r,logout:o}=(0,i.a)();return"login"===e?(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-blue-600",children:[(0,a.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-blue-600 border-t-transparent rounded-full"}),(0,a.jsx)("span",{className:"text-sm",children:"Signing in..."})]}):s?(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-blue-600",children:[(0,a.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-blue-600 border-t-transparent rounded-full"}),(0,a.jsx)("span",{className:"text-sm",children:"Getting access token..."})]}):t?(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"flex items-center space-x-2",children:l?(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-green-600",children:[(0,a.jsx)(W.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Authenticated"})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-yellow-600",children:[(0,a.jsx)(z.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Getting token..."})]})}),n&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-gray-700",children:[(0,a.jsx)(q.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm",children:n.name||n.email})]}),(0,a.jsxs)("button",{onClick:o,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,a.jsx)(M.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm",children:"Sign Out"})]})]}):(0,a.jsxs)("button",{onClick:r,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,a.jsx)(R.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Sign In"})]})}var _=s(8420),Y=s(6215),J=s(3417),Q=s(1671);function $(e){let{id:t,label:s,icon:l,isActive:n,onClick:r}=e;return(0,a.jsxs)("button",{onClick:r,className:"group flex items-center space-x-2 px-3 py-1.5 rounded-md font-medium transition-all duration-300 transform hover:scale-105 ".concat(n?"bg-gradient-to-r from-financial-blue-600 to-financial-indigo-600 text-white shadow-lg shadow-financial-blue-600/30":"text-financial-slate-600 hover:text-financial-blue-600 hover:bg-white/70 hover:shadow-md"),children:[(0,a.jsx)("span",{className:"transition-transform duration-300 ".concat(n?"scale-110":"group-hover:scale-110"),children:l}),(0,a.jsx)("span",{className:"text-xs font-semibold",children:s})]})}function K(){let[e,t]=(0,l.useState)("checking"),[s,n]=(0,l.useState)("checking"),[o,c]=(0,l.useState)("holdings"),{isAuthenticated:d}=(0,i.a)();return(0,l.useEffect)(()=>{(async()=>{console.log("Checking services, authenticated:",d);try{let e=await r.x.testConnection();if(t(e?"online":"offline"),d){n("checking");try{let e=await r.x.getChatHealthStatus();n(e.error?"offline":"online")}catch(e){console.log("AI service check failed:",e),n("offline")}}else console.log("Not authenticated, setting AI status to offline"),n("offline")}catch(e){t("offline"),n("offline")}})()},[d]),(0,a.jsxs)("div",{className:"h-screen bg-gradient-to-br from-financial-slate-50 via-financial-blue-50 to-financial-indigo-50 flex flex-col",children:[(0,a.jsxs)("header",{className:"bg-white/80 backdrop-blur-xl shadow-financial-lg border-b border-white/20 flex-shrink-0 relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-financial-blue-500/5 to-financial-indigo-500/5"}),(0,a.jsx)("div",{className:"relative w-full px-4 sm:px-6 lg:px-8 py-2",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(_.Z,{className:"h-6 w-6 text-financial-blue-600 relative z-10"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-financial-blue-400/20 rounded-lg scale-150 animate-pulse-slow"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold bg-gradient-to-r from-financial-slate-800 to-financial-blue-600 bg-clip-text text-transparent",children:"Portfolio Manager"}),(0,a.jsx)("p",{className:"text-xs text-financial-slate-500 font-medium",children:"AI-Powered Investment Management"})]})]}),(0,a.jsxs)("div",{className:"flex space-x-1 bg-white/60 backdrop-blur-md p-1 rounded-lg border border-white/30 shadow-financial",children:[(0,a.jsx)($,{id:"holdings",label:"Portfolio Holdings",icon:(0,a.jsx)(Y.Z,{className:"h-4 w-4"}),isActive:"holdings"===o,onClick:()=>c("holdings")}),(0,a.jsx)($,{id:"chat",label:"AI Assistant",icon:(0,a.jsx)(J.Z,{className:"h-4 w-4"}),isActive:"chat"===o,onClick:()=>c("chat")})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(O,{})}),(0,a.jsx)("div",{className:"h-6 w-px bg-gray-300"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[!d&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-financial-gray-400",children:[(0,a.jsx)(_.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm",children:"API (Auth Required)"})]}),d&&"checking"===e&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-financial-gray-500",children:[(0,a.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-financial-gray-300 border-t-primary-600 rounded-full"}),(0,a.jsx)("span",{className:"text-sm",children:"Checking API..."})]}),d&&"online"===e&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-financial-green",children:[(0,a.jsx)(Q.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"API Online"})]}),d&&"offline"===e&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-financial-red",children:[(0,a.jsx)(z.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"API Offline"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[!d&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-financial-gray-400",children:[(0,a.jsx)(T.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm",children:"AI (Auth Required)"})]}),d&&"checking"===s&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-financial-gray-500",children:[(0,a.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-financial-gray-300 border-t-blue-600 rounded-full"}),(0,a.jsx)("span",{className:"text-sm",children:"Checking AI..."})]}),d&&"online"===s&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-blue-600",children:[(0,a.jsx)(T.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"AI Online"})]}),d&&"offline"===s&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-financial-red",children:[(0,a.jsx)(z.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"AI Offline"})]})]})]})]})})]}),("offline"===e||"offline"===s&&d||!d&&"chat"===o)&&(0,a.jsx)("div",{className:"flex-shrink-0 px-4 sm:px-6 lg:px-8 pt-2",children:(0,a.jsxs)("div",{className:"space-y-2",children:["offline"===e&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(z.Z,{className:"h-5 w-5 text-red-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-red-800",children:"API Connection Error"}),(0,a.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"Unable to connect to the Portfolio Manager API. Portfolio data may not be available."})]})]})}),!d&&"chat"===o&&(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(T.Z,{className:"h-5 w-5 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-blue-800",children:"Authentication Required"}),(0,a.jsx)("p",{className:"text-xs text-blue-700 mt-1",children:"Please sign in to access the AI assistant and chat functionality."})]})]})}),"offline"===s&&d&&(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(T.Z,{className:"h-5 w-5 text-yellow-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-yellow-800",children:"AI Assistant Unavailable"}),(0,a.jsx)("p",{className:"text-xs text-yellow-700 mt-1",children:"The AI assistant is currently offline. Chat functionality will be limited."})]})]})})]})}),(0,a.jsx)("main",{className:"flex-1 overflow-hidden px-4 sm:px-6 lg:px-8 pt-2 pb-2",children:(0,a.jsxs)("div",{className:"h-full bg-white/90 backdrop-blur-sm rounded-2xl shadow-financial-lg border border-white/20 overflow-hidden relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-white/50 to-financial-blue-50/30 pointer-events-none"}),(0,a.jsx)("div",{className:"holdings"===o?"block h-full relative z-10":"hidden",children:(0,a.jsx)("div",{className:"h-full overflow-hidden",children:(0,a.jsx)(P,{})})}),(0,a.jsxs)("div",{className:"chat"===o?"block h-full":"hidden",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-financial-blue-600 to-financial-indigo-600 text-white p-4 relative z-10",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(J.Z,{className:"h-5 w-5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"AI Portfolio Assistant"}),(0,a.jsxs)("p",{className:"text-blue-100 text-sm",children:["Ask questions about your portfolio and get AI-powered insights for Account ",1]})]})]})}),(0,a.jsx)("div",{className:"h-[calc(100%-5rem)] overflow-hidden",children:(0,a.jsx)(H,{accountId:1,isVisible:"chat"===o})})]})]})})]})}}},function(e){e.O(0,[292,884,314,112,335,362,971,117,744],function(){return e(e.s=3162)}),_N_E=e.O()}]);